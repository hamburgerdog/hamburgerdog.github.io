---
layout: post
title:  "GOè¯­è¨€ç¼–å†™è§„èŒƒç®€è®°"
date:   2021-01-10 13:25:00 +0800
tags: Golang æœåŠ¡ç«¯
color: rgb(255,210,32)
cover: '../assets/go_title.jpeg'
subtitle: 'goå­¦ä¹ ç¬”è®°'
---
<div class="md-toc" mdtype="toc">
	<p class="md-toc-content" role="list">
		<span role="listitem" class="md-toc-item md-toc-h1" data-ref="n949">
			<a class="md-toc-inner" href="#zapgo-è¯­è¨€ç¼–å†™è§„èŒƒç®€è®°-zap">âš¡ï¸ GO è¯­è¨€ç¼–å†™è§„èŒƒç®€è®° âš¡ï¸</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n954">
			<a class="md-toc-inner" href="#å‘½å-memo">å‘½å ğŸ“</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n971"><a class="md-toc-inner" href="#åˆ†å·-"> åˆ†å·ï¼›</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n978">
			<a class="md-toc-inner" href="#æ§åˆ¶ç»“æ„-arrowsclockwise">æ§åˆ¶ç»“æ„ ğŸ”ƒ</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n979">
			<a class="md-toc-inner" href="#é‡æ–°å£°æ˜å’Œå†æ¬¡èµ‹å€¼">é‡æ–°å£°æ˜å’Œå†æ¬¡èµ‹å€¼</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n989">
			<a class="md-toc-inner" href="#switch-soon">switch ğŸ”œ</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n995">
			<a class="md-toc-inner" href="#å‡½æ•°-func-">å‡½æ•° func( )</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n996">
			<a class="md-toc-inner" href="#å¤šå€¼è¿”å›-arrowrighthook">å¤šå€¼è¿”å› â†ªï¸</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n998">
			<a class="md-toc-inner" href="#defer-pushpin">defer ğŸ“Œ</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1002">
			<a class="md-toc-inner" href="#æ•°æ®-bookmarktabs">æ•°æ® ğŸ“‘</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1003">
			<a class="md-toc-inner" href="#newå’Œmake-åˆ†é…-factory">newå’Œmake åˆ†é… ğŸ­</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1011">
			<a class="md-toc-inner" href="#æ„é€ å‡½æ•°-å’Œ-å¤åˆå­—é¢"><mark>æ„é€ å‡½æ•° å’Œ å¤åˆå­—é¢</mark>â€‹</a><br> </span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1023">
			<a class="md-toc-inner" href="#æ•°ç»„-">æ•°ç»„ [...]</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1033">
			<a class="md-toc-inner" href="#åˆ‡ç‰‡-">åˆ‡ç‰‡ [:]</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1035">
			<a class="md-toc-inner" href="#äºŒç»´åˆ‡ç‰‡--">äºŒç»´åˆ‡ç‰‡ [:] [:]</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1040">
			<a class="md-toc-inner" href="#æ˜ å°„-mapkey-t-value-t">æ˜ å°„ map[key T] value T</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1046">
			<a class="md-toc-inner" href="#æ‰“å°-printer">æ‰“å° ğŸ–¨</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1047">
			<a class="md-toc-inner" href="#fmtprintf"><code>fmt.Printf()</code></a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1055">
			<a class="md-toc-inner" href="#fmtsprintf"><code>fmt.Sprintf()</code></a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1058">
			<a class="md-toc-inner" href="#è¿½åŠ -putlitterinitsplace">è¿½åŠ  ğŸš®</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1062">
			<a class="md-toc-inner" href="#åˆå§‹åŒ–--init">åˆå§‹åŒ– <code> init()</code></a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1065">
			<a class="md-toc-inner" href="#æŒ‡é’ˆ-vs-å€¼-">æŒ‡é’ˆ Vs å€¼ *</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1067">
			<a class="md-toc-inner" href="#æ¥å£-ä¸-å…¶ä»–ç±»å‹-t">æ¥å£ ä¸ å…¶ä»–ç±»å‹ T</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1068">
			<a class="md-toc-inner" href="#ç±»å‹æ–­è¨€-t-ttypename">ç±»å‹æ–­è¨€ <code>t T.(typeName)</code></a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1076">
			<a class="md-toc-inner" href="#é€šç”¨æ€§-dollar">é€šç”¨æ€§ ğŸ’µ</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1080">
			<a class="md-toc-inner" href="#æ¥å£å’Œæ–¹æ³•">æ¥å£å’Œæ–¹æ³•</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1089">
			<a class="md-toc-inner" href="#ç©ºç™½æ ‡è¯†ç¬¦-">ç©ºç™½æ ‡è¯†ç¬¦ _</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1090">
			<a class="md-toc-inner" href="#ç”¨äºåœ¨è°ƒè¯•æ—¶é¿å…ç¼–è¯‘é”™è¯¯-bug">ç”¨äºåœ¨è°ƒè¯•æ—¶é¿å…ç¼–è¯‘é”™è¯¯ ğŸ›</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1094">
			<a class="md-toc-inner" href="#å†…åµŒ-bulb"><strong><mark>å†…åµŒ</mark></strong> ğŸ’¡</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1121">
			<a class="md-toc-inner" href="#å¹¶å‘-twistedrightwardsarrows">å¹¶å‘ ğŸ”€</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1124">
			<a class="md-toc-inner" href="#ä¿¡é“--">ä¿¡é“ &lt;-</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1131">
			<a class="md-toc-inner" href="#å¹¶è¡ŒåŒ–">å¹¶è¡ŒåŒ–</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1140">
			<a class="md-toc-inner" href="#é”™è¯¯-noentry">é”™è¯¯ â›”ï¸</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1141">
			<a class="md-toc-inner" href="#error-warning">Error âš ï¸</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1146">
			<a class="md-toc-inner" href="#panic-brokenheart">Panic ğŸ’”</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1149">
			<a class="md-toc-inner" href="#recover-hospital">Recover ğŸ¥</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1159">
			<a class="md-toc-inner" href="#ä¸€ä¸ªwebæœåŠ¡å™¨-tada">ä¸€ä¸ªWebæœåŠ¡å™¨ ğŸ‰</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1171">
			<a class="md-toc-inner" href="#å†…å­˜-goroutine">å†…å­˜ goroutine</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1176">
			<a class="md-toc-inner" href="#äº‹ä»¶å‘ç”Ÿçš„æ¬¡åº">äº‹ä»¶å‘ç”Ÿçš„æ¬¡åº</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1200">
			<a class="md-toc-inner" href="#åŒæ­¥-sync">åŒæ­¥ sync</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1201">
			<a class="md-toc-inner" href="#åˆå§‹åŒ–">åˆå§‹åŒ– </a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1206">
			<a class="md-toc-inner" href="#goç¨‹çš„é”€æ¯">goç¨‹çš„é”€æ¯</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1212">
			<a class="md-toc-inner" href="#ä¿¡é“é€šä¿¡">ä¿¡é“é€šä¿¡</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1225">
			<a class="md-toc-inner" href="#é”-lock">é” ğŸ”’</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1231">
			<a class="md-toc-inner" href="#onceç±»å‹-one">Onceç±»å‹ 1ï¸âƒ£</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1256">
			<a class="md-toc-inner" href="#é”™è¯¯çš„åŒæ­¥">é”™è¯¯çš„åŒæ­¥</a><br>
		</span>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1248">
			<a class="md-toc-inner" href="#å…¶ä»–-package">å…¶ä»– ğŸ“¦</a><br>
		</span>
	</p>
</div>

# :zap:GO è¯­è¨€ç¼–å†™è§„èŒƒç®€è®° :zap:

>:link: [å®æ•ˆGOè¯­è¨€ç¼–ç¨‹](https://go-zh.org/doc/effective_go.html#%E5%90%8D%E7%A7%B0) å­¦ä¹ ç®€è®°

## å‘½å :memo:

1. **åŒ…å‘½åï¼š**åŒ…åº”å½“ä»¥å°å†™çš„å•ä¸ªå•è¯æ¥å‘½åï¼Œä¸”ä¸åº”ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–é©¼å³°è®°æ³•ï¼ŒåŒ…åå°±æ˜¯å¯¼å…¥æ—¶æ‰€éœ€çš„å”¯ä¸€é»˜è®¤åç§°ï¼Œ å®ƒå¹¶ä¸éœ€è¦åœ¨æ‰€æœ‰æºç ä¸­ä¿æŒå”¯ä¸€ï¼Œå³ä¾¿åœ¨å°‘æ•°å‘ç”Ÿå†²çªçš„æƒ…å†µä¸‹ï¼Œ ä¹Ÿå¯ä¸ºå¯¼å…¥çš„åŒ…é€‰æ‹©ä¸€ä¸ªåˆ«åæ¥å±€éƒ¨ä½¿ç”¨ã€‚ æ— è®ºå¦‚ä½•ï¼Œé€šè¿‡æ–‡ä»¶åæ¥åˆ¤å®šä½¿ç”¨çš„åŒ…ï¼Œéƒ½æ˜¯ä¸ä¼šäº§ç”Ÿæ··æ·†çš„ã€‚
   *  `once.Do`ï¼Œ`once.Do(setup)` è¡¨è¿°è¶³å¤Ÿæ¸…æ™°ï¼Œ ä½¿ç”¨ `once.DoOrWaitUntilDone(setup)` å®Œå…¨å°±æ˜¯ç”»è›‡æ·»è¶³ã€‚ é•¿å‘½åå¹¶ä¸ä¼šä½¿å…¶æ›´å…·å¯è¯»æ€§ã€‚ä¸€ä»½æœ‰ç”¨çš„è¯´æ˜æ–‡æ¡£é€šå¸¸æ¯”é¢å¤–çš„é•¿åæ›´æœ‰ä»·å€¼ã€‚
   * ä¾‹å¦‚ï¼Œ`bufio` åŒ…ä¸­çš„ç¼“å­˜è¯»å–å™¨ç±»å‹å«åš `Reader` è€Œé `BufReader`ï¼Œå› ä¸ºç”¨æˆ·å°†å®ƒçœ‹åš `bufio.Reader`ï¼Œè¿™æ˜¯ä¸ªæ¸…æ¥šè€Œç®€æ´çš„åç§°ã€‚ æ­¤å¤–ï¼Œç”±äºè¢«å¯¼å…¥çš„é¡¹æ€»æ˜¯é€šè¿‡å®ƒä»¬çš„åŒ…åæ¥ç¡®å®šï¼Œå› æ­¤ `bufio.Reader` ä¸ä¼šä¸ `io.Reader` å‘ç”Ÿå†²çªã€‚
   * åŒæ ·ï¼Œç”¨äºåˆ›å»º `ring.Ring` çš„æ–°å®ä¾‹çš„å‡½æ•°ï¼ˆè¿™å°±æ˜¯Goä¸­çš„**æ„é€ å‡½æ•°**ï¼‰ä¸€èˆ¬ä¼šç§°ä¹‹ä¸º `NewRing`ï¼Œä½†ç”±äº `Ring` æ˜¯è¯¥åŒ…æ‰€å¯¼å‡ºçš„å”¯ä¸€ç±»å‹ï¼Œä¸”è¯¥åŒ…ä¹Ÿå« `ring`ï¼Œå› æ­¤å®ƒå¯ä»¥åªå«åš `New`ï¼Œå®ƒè·Ÿåœ¨åŒ…çš„åé¢ï¼Œå°±åƒ `ring.New`ã€‚ä½¿ç”¨åŒ…ç»“æ„å¯ä»¥å¸®åŠ©ä½ é€‰æ‹©å¥½çš„åç§°ã€‚
2. **è·å–å™¨ï¼š**è‹¥ä½ æœ‰ä¸ªåä¸º `owner` ï¼ˆå°å†™ï¼Œæœªå¯¼å‡ºï¼‰çš„å­—æ®µï¼Œå…¶è·å–å™¨åº”å½“åä¸º `Owner`ï¼ˆå¤§å†™ï¼Œå¯å¯¼å‡ºï¼‰è€Œé `GetOwner`ã€‚å¤§å†™å­—æ¯å³ä¸ºå¯å¯¼å‡ºçš„è¿™ç§è§„å®šä¸ºåŒºåˆ†æ–¹æ³•å’Œå­—æ®µæä¾›äº†ä¾¿åˆ©ã€‚ è‹¥è¦æä¾›è®¾ç½®å™¨æ–¹æ³•ï¼Œ`SetOwner` æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚
3. **æ¥å£åï¼š**æŒ‰ç…§çº¦å®šï¼ŒåªåŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ¥å£åº”å½“ä»¥è¯¥æ–¹æ³•çš„åç§°åŠ ä¸Š-eråç¼€æ¥å‘½åï¼Œå¦‚ `Reader`ã€`Writer`ã€ `Formatter`ã€`CloseNotifier` ç­‰ã€‚
4. **é©¼å³°æ³•ï¼š**æœ€åï¼ŒGoä¸­çº¦å®šä½¿ç”¨é©¼å³°è®°æ³• `MixedCaps` æˆ– `mixedCaps`ã€‚

## åˆ†å· ï¼›

> å’ŒCä¸€æ ·ï¼ŒGoçš„æ­£å¼è¯­æ³•ä½¿ç”¨åˆ†å·æ¥ç»“æŸè¯­å¥ï¼›å’ŒCä¸åŒçš„æ˜¯ï¼Œè¿™äº›åˆ†å·å¹¶ä¸åœ¨æºç ä¸­å‡ºç°ã€‚ å–è€Œä»£ä¹‹ï¼Œè¯æ³•åˆ†æå™¨ä¼šä½¿ç”¨ä¸€æ¡ç®€å•çš„è§„åˆ™æ¥è‡ªåŠ¨æ’å…¥åˆ†å·ï¼Œå› æ­¤å› æ­¤æºç ä¸­åŸºæœ¬å°±ä¸ç”¨åˆ†å·äº†ã€‚

 è§„åˆ™ç®€è¿°ä¸º â€œå¦‚æœæ–°è¡Œå‰çš„æ ‡è®°ä¸ºè¯­å¥çš„æœ«å°¾ï¼Œåˆ™æ’å…¥åˆ†å·â€

æ ‡è¯†ç¬¦ï¼ˆåŒ…æ‹¬ `int` å’Œ `float64` è¿™ç±»çš„å•è¯ï¼‰ã€æ•°å€¼æˆ–å­—ç¬¦ä¸²å¸¸é‡ä¹‹ç±»çš„åŸºæœ¬å­—é¢æˆ–ä»¥ä¸‹æ ‡è®°ä¹‹ä¸€
```go
break continue fallthrough return ++ -- ) }
```

:warning: ï¼šæ— è®ºå¦‚ä½•ï¼Œä½ éƒ½ä¸åº”å°†ä¸€ä¸ªæ§åˆ¶ç»“æ„ï¼ˆ`if`ã€`for`ã€`switch` æˆ– `select`ï¼‰çš„å·¦å¤§æ‹¬å·æ”¾åœ¨ä¸‹ä¸€è¡Œã€‚

## æ§åˆ¶ç»“æ„ :arrows_clockwise:

### é‡æ–°å£°æ˜å’Œå†æ¬¡èµ‹å€¼

åœ¨æ»¡è¶³ä¸‹åˆ—æ¡ä»¶æ—¶ï¼Œå·²è¢«å£°æ˜çš„å˜é‡ `v` å¯å‡ºç°åœ¨`:=` å£°æ˜ä¸­ï¼š

- æœ¬æ¬¡å£°æ˜ä¸å·²å£°æ˜çš„ `v` å¤„äºåŒä¸€ä½œç”¨åŸŸä¸­ï¼ˆè‹¥ `v` å·²åœ¨å¤–å±‚ä½œç”¨åŸŸä¸­å£°æ˜è¿‡ï¼Œåˆ™æ­¤æ¬¡å£°æ˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡Â§ï¼‰ï¼Œ
- **åœ¨åˆå§‹åŒ–ä¸­ä¸å…¶ç±»å‹ç›¸åº”çš„å€¼æ‰èƒ½èµ‹äºˆ** `v`ï¼Œä¸”
- åœ¨æ­¤æ¬¡å£°æ˜ä¸­è‡³å°‘å¦æœ‰ä¸€ä¸ªå˜é‡æ˜¯æ–°å£°æ˜çš„ã€‚

:alarm_clock: å³ä¾¿Goä¸­çš„å‡½æ•°å½¢å‚å’Œè¿”å›å€¼åœ¨è¯æ³•ä¸Šå¤„äºå¤§æ‹¬å·ä¹‹å¤–ï¼Œ ä½†å®ƒä»¬çš„ä½œç”¨åŸŸå’Œè¯¥å‡½æ•°ä½“ä»ç„¶ç›¸åŒã€‚

### switch :soon:

`case` è¯­å¥ä¼šè‡ªä¸Šè€Œä¸‹é€ä¸€è¿›è¡Œæ±‚å€¼ç›´åˆ°åŒ¹é…ä¸ºæ­¢ã€‚è‹¥ `switch` åé¢æ²¡æœ‰è¡¨è¾¾å¼ï¼Œå®ƒå°†åŒ¹é… `true`ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† `if-else-if-else` é“¾å†™æˆä¸€ä¸ª `switch`ï¼Œè¿™ä¹Ÿæ›´ç¬¦åˆGoçš„é£æ ¼ã€‚`switch` å¹¶ä¸ä¼šè‡ªåŠ¨ä¸‹æº¯ï¼Œä½† `case` å¯é€šè¿‡é€—å·åˆ†éš”æ¥åˆ—ä¸¾ç›¸åŒçš„å¤„ç†æ¡ä»¶ã€‚

`switch` ä¹Ÿå¯ç”¨äºåˆ¤æ–­æ¥å£å˜é‡çš„åŠ¨æ€ç±»å‹ã€‚å¦‚ **ç±»å‹é€‰æ‹©** é€šè¿‡åœ†æ‹¬å·ä¸­çš„å…³é”®å­— `type` ä½¿ç”¨ç±»å‹æ–­è¨€è¯­æ³•ã€‚è‹¥ `switch` åœ¨è¡¨è¾¾å¼ä¸­å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¯¥å˜é‡çš„æ¯ä¸ªå­å¥ä¸­éƒ½å°†æœ‰è¯¥å˜é‡å¯¹åº”çš„ç±»å‹ã€‚

```go
//	ç±»å‹é€‰æ‹©
var t interface{}
t = functionOfSomeType()
switch t := t.(type) {
default:
	fmt.Printf("unexpected type %T", t)       // %T è¾“å‡º t æ˜¯ä»€ä¹ˆç±»å‹
case bool:
	fmt.Printf("boolean %t\n", t)             // t æ˜¯ bool ç±»å‹
case int:
	fmt.Printf("integer %d\n", t)             // t æ˜¯ int ç±»å‹
case *bool:
	fmt.Printf("pointer to boolean %t\n", *t) // t æ˜¯ *bool ç±»å‹
case *int:
	fmt.Printf("pointer to integer %d\n", *t) // t æ˜¯ *int ç±»å‹
}
```

å°½ç®¡å®ƒä»¬åœ¨Goä¸­çš„ç”¨æ³•å’Œå…¶å®ƒç±»Cè¯­è¨€å·®ä¸å¤šï¼Œä½† `break` è¯­å¥å¯ä»¥ä½¿ `switch` æå‰ç»ˆæ­¢ã€‚ä¸ä»…æ˜¯ `switch`ï¼Œ æœ‰æ—¶å€™ä¹Ÿå¿…é¡»æ‰“ç ´å±‚å±‚çš„å¾ªç¯ã€‚åœ¨Goä¸­ï¼Œæˆ‘ä»¬åªéœ€å°†æ ‡ç­¾æ”¾ç½®åˆ°å¾ªç¯å¤–ï¼Œç„¶å â€œè¹¦â€åˆ°é‚£é‡Œå³å¯ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†äºŒè€…çš„ç”¨æ³•ã€‚

```go
package main

import "fmt"

func main() {
Loop:
	for i := 1;; i++ {
		switch {
		case i == 1:
			fmt.Println(i)
			break
		case i == 2:
			fmt.Println(i)
			break

		case i == 3:
			fmt.Println(i)
			break
		default:
			fmt.Println(i)
			break Loop	//	è·³å‡ºäº†å¾ªç¯
		}
	}
}

>>>>
go run test_go.go
1
2
3
4
```

## å‡½æ•° func( )

### å¤šå€¼è¿”å› :arrow_right_hook:

Goä¸ä¼—ä¸åŒçš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å‡½æ•°å’Œæ–¹æ³•å¯è¿”å›å¤šä¸ªå€¼ã€‚è¿™ç§å½¢å¼å¯ä»¥æ”¹å–„Cä¸­ä¸€äº›ç¬¨æ‹™çš„ä¹ æƒ¯ï¼š å°†é”™è¯¯å€¼è¿”å›ï¼ˆä¾‹å¦‚ç”¨ `-1` è¡¨ç¤º `EOF`ï¼‰å’Œä¿®æ”¹é€šè¿‡åœ°å€ä¼ å…¥çš„å®å‚ã€‚

### defer :pushpin:

è¢«æ¨è¿Ÿå‡½æ•°çš„å®å‚ï¼ˆå¦‚æœè¯¥å‡½æ•°ä¸ºæ–¹æ³•åˆ™è¿˜åŒ…æ‹¬æ¥æ”¶è€…ï¼‰åœ¨**æ¨è¿Ÿ**æ‰§è¡Œæ—¶å°±ä¼šæ±‚å€¼ï¼Œ è€Œä¸æ˜¯åœ¨**è°ƒç”¨**æ‰§è¡Œæ—¶æ‰æ±‚å€¼ã€‚è¿™æ ·ä¸ä»…æ— éœ€æ‹…å¿ƒå˜é‡å€¼åœ¨å‡½æ•°æ‰§è¡Œæ—¶è¢«æ”¹å˜ï¼Œ åŒæ—¶è¿˜æ„å‘³ç€å•ä¸ªå·²æ¨è¿Ÿçš„è°ƒç”¨å¯æ¨è¿Ÿå¤šä¸ªå‡½æ•°çš„æ‰§è¡Œã€‚ä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­ã€‚

```
for i := 0; i < 5; i++ {
	defer fmt.Printf("%d ", i)
}
```

è¢«æ¨è¿Ÿçš„å‡½æ•°æŒ‰ç…§å…ˆè¿›åå‡ºï¼ˆLIFOï¼‰çš„é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä»¥ä¸Šä»£ç åœ¨å‡½æ•°è¿”å›æ—¶ä¼šæ‰“å° `4 3 2 1 0`ã€‚

## æ•°æ® :bookmark_tabs:

### newå’Œmake åˆ†é… :factory:

`new`æ˜¯ä¸ªç”¨æ¥åˆ†é…å†…å­˜çš„å†…å»ºå‡½æ•°ï¼Œ ä½†ä¸å…¶å®ƒè¯­è¨€ä¸­çš„åŒåå‡½æ•°ä¸åŒï¼Œå®ƒä¸ä¼š**åˆå§‹åŒ–**å†…å­˜ï¼Œåªä¼šå°†å†…å­˜**ç½®é›¶**ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œ`new(T)` ä¼šä¸ºç±»å‹ä¸º `T` çš„æ–°é¡¹åˆ†é…å·²ç½®é›¶çš„å†…å­˜ç©ºé—´ï¼Œ å¹¶è¿”å›å®ƒçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç±»å‹ä¸º `*T` çš„å€¼ã€‚ç”¨Goçš„æœ¯è¯­æ¥è¯´ï¼Œå®ƒè¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œ è¯¥æŒ‡é’ˆæŒ‡å‘æ–°åˆ†é…çš„ï¼Œç±»å‹ä¸º `T` çš„é›¶å€¼ã€‚

å†…å»ºå‡½æ•° `make(T, args)` çš„ç›®çš„ä¸åŒäº `new(T)`ã€‚å®ƒåªç”¨äºåˆ›å»ºåˆ‡ç‰‡ã€æ˜ å°„å’Œä¿¡é“ï¼Œå¹¶è¿”å›ç±»å‹ä¸º `T`ï¼ˆè€Œé `*T`ï¼‰çš„ä¸€ä¸ª**å·²åˆå§‹åŒ–** ï¼ˆè€Œé**ç½®é›¶**ï¼‰çš„å€¼ã€‚ å‡ºç°è¿™ç§ç”¨å·®å¼‚çš„åŸå› åœ¨äºï¼Œè¿™ä¸‰ç§ç±»å‹æœ¬è´¨ä¸Šä¸ºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œå®ƒä»¬åœ¨ä½¿ç”¨å‰å¿…é¡»åˆå§‹åŒ–ã€‚ ä¾‹å¦‚ï¼Œåˆ‡ç‰‡æ˜¯ä¸€ä¸ªå…·æœ‰ä¸‰é¡¹å†…å®¹çš„æè¿°ç¬¦ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘ï¼ˆæ•°ç»„å†…éƒ¨ï¼‰æ•°æ®çš„æŒ‡é’ˆã€é•¿åº¦ä»¥åŠå®¹é‡ï¼Œ åœ¨è¿™ä¸‰é¡¹è¢«åˆå§‹åŒ–ä¹‹å‰ï¼Œè¯¥åˆ‡ç‰‡ä¸º `nil`ã€‚å¯¹äºåˆ‡ç‰‡ã€æ˜ å°„å’Œä¿¡é“ï¼Œ`make` ç”¨äºåˆå§‹åŒ–å…¶å†…éƒ¨çš„æ•°æ®ç»“æ„å¹¶å‡†å¤‡å¥½å°†è¦ä½¿ç”¨çš„å€¼ã€‚ä¾‹å¦‚ï¼Œ

```
make([]int, 10, 100)
```

ä¼šåˆ†é…ä¸€ä¸ªå…·æœ‰100ä¸ª `int` çš„æ•°ç»„ç©ºé—´ï¼Œæ¥ç€åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º10ï¼Œ å®¹é‡ä¸º100å¹¶æŒ‡å‘è¯¥æ•°ç»„ä¸­å‰10ä¸ªå…ƒç´ çš„åˆ‡ç‰‡ç»“æ„ã€‚ï¼ˆç”Ÿæˆåˆ‡ç‰‡æ—¶ï¼Œå…¶å®¹é‡å¯ä»¥çœç•¥ï¼Œæ›´å¤šä¿¡æ¯è§åˆ‡ç‰‡ä¸€èŠ‚ã€‚ï¼‰ ä¸æ­¤ç›¸åï¼Œ`new([]int)` ä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘æ–°åˆ†é…çš„ï¼Œå·²ç½®é›¶çš„åˆ‡ç‰‡ç»“æ„ï¼Œ å³ä¸€ä¸ªæŒ‡å‘ `nil` åˆ‡ç‰‡å€¼çš„æŒ‡é’ˆã€‚

ä¸‹é¢çš„ä¾‹å­é˜æ˜äº† `new` å’Œ `make` ä¹‹é—´çš„åŒºåˆ«ï¼š

```
var p *[]int = new([]int)       // åˆ†é…åˆ‡ç‰‡ç»“æ„ï¼›*p == nilï¼›åŸºæœ¬æ²¡ç”¨
var v  []int = make([]int, 100) // åˆ‡ç‰‡ v ç°åœ¨å¼•ç”¨äº†ä¸€ä¸ªå…·æœ‰ 100 ä¸ª int å…ƒç´ çš„æ–°æ•°ç»„

// æ²¡å¿…è¦çš„å¤æ‚ï¼š
var p *[]int = new([]int)
*p = make([]int, 100, 100)

// ä¹ æƒ¯ç”¨æ³•ï¼š
v := make([]int, 100)
```

è¯·è®°ä½ï¼Œ`make` åªé€‚ç”¨äºæ˜ å°„ã€åˆ‡ç‰‡å’Œä¿¡é“ä¸”ä¸è¿”å›æŒ‡é’ˆã€‚è‹¥è¦è·å¾—æ˜ç¡®çš„æŒ‡é’ˆï¼Œ è¯·ä½¿ç”¨ `new` åˆ†é…å†…å­˜ã€‚

### ==æ„é€ å‡½æ•° å’Œ å¤åˆå­—é¢==â€‹

æœ‰æ—¶é›¶å€¼è¿˜ä¸å¤Ÿå¥½ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªåˆå§‹åŒ–æ„é€ å‡½æ•°ï¼Œå¦‚æ¥è‡ª `os` åŒ…ä¸­çš„è¿™æ®µä»£ç æ‰€ç¤ºã€‚

```go
func NewFile(fd int, name string) *File {
	if fd < 0 {
		return nil
	}
	f := new(File)
	f.fd = fd
	f.name = name
	f.dirinfo = nil
	f.nepipe = 0
	return f
}
```

è¿™é‡Œæ˜¾å¾—ä»£ç è¿‡äºå†—é•¿ã€‚æˆ‘ä»¬å¯é€šè¿‡**å¤åˆå­—é¢**æ¥ç®€åŒ–å®ƒï¼Œ è¯¥è¡¨è¾¾å¼åœ¨æ¯æ¬¡æ±‚å€¼æ—¶éƒ½ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ã€‚

```go
func NewFile(fd int, name string) *File {
	if fd < 0 {
		return nil
	}
	f := File{fd, name, nil, 0}
	return &f
}
```

è¯·æ³¨æ„ï¼Œè¿”å›ä¸€ä¸ªå±€éƒ¨å˜é‡çš„åœ°å€å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œè¿™ç‚¹ä¸Cä¸åŒã€‚è¯¥å±€éƒ¨å˜é‡å¯¹åº”çš„æ•°æ® åœ¨å‡½æ•°è¿”å›åä¾ç„¶æœ‰æ•ˆã€‚å®é™…ä¸Šï¼Œæ¯å½“è·å–ä¸€ä¸ªå¤åˆå­—é¢çš„åœ°å€æ—¶ï¼Œéƒ½å°†ä¸ºä¸€ä¸ªæ–°çš„å®ä¾‹åˆ†é…å†…å­˜ï¼Œ å› æ­¤æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„æœ€åä¸¤è¡Œä»£ç åˆå¹¶ï¼š

```go
	return &File{fd, name, nil, 0}
```

å¤åˆå­—é¢çš„å­—æ®µå¿…é¡»æŒ‰é¡ºåºå…¨éƒ¨åˆ—å‡ºã€‚ä½†å¦‚æœä»¥ **å­—æ®µ**`:`**å€¼** å¯¹çš„å½¢å¼æ˜ç¡®åœ°æ ‡å‡ºå…ƒç´ ï¼Œåˆå§‹åŒ–å­—æ®µæ—¶å°±å¯ä»¥æŒ‰ä»»ä½•é¡ºåºå‡ºç°ï¼Œæœªç»™å‡ºçš„å­—æ®µå€¼å°†èµ‹äºˆé›¶å€¼ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å½¢å¼ï¼š

```go
	return &File{fd: fd, name: name}
```

å°‘æ•°æƒ…å†µä¸‹ï¼Œè‹¥å¤åˆå­—é¢ä¸åŒ…æ‹¬ä»»ä½•å­—æ®µï¼Œå®ƒå°†åˆ›å»ºè¯¥ç±»å‹çš„é›¶å€¼ã€‚è¡¨è¾¾å¼ `new(File)` å’Œ `&File{}` æ˜¯ç­‰ä»·çš„ã€‚

å¤åˆå­—é¢åŒæ ·å¯ç”¨äºåˆ›å»ºæ•°ç»„ã€åˆ‡ç‰‡ä»¥åŠæ˜ å°„ï¼Œå­—æ®µæ ‡ç­¾æ˜¯ç´¢å¼•è¿˜æ˜¯æ˜ å°„é”®åˆ™è§†æƒ…å†µè€Œå®šã€‚ åœ¨ä¸‹ä¾‹åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæ— è®º `Enone`ã€`Eio` å’Œ `Einval` çš„å€¼æ˜¯ä»€ä¹ˆï¼Œåªè¦å®ƒä»¬çš„æ ‡ç­¾ä¸åŒå°±è¡Œã€‚

```go
a := [...]string   {Enone: "no error", Eio: "Eio", Einval: "invalid argument"}
s := []string      {Enone: "no error", Eio: "Eio", Einval: "invalid argument"}
m := map[int]string{Enone: "no error", Eio: "Eio", Einval: "invalid argument"}
```

### æ•°ç»„ [...]

ä¸»è¦ç”¨ä½œåˆ‡ç‰‡çš„æ„ä»¶ï¼Œåœ¨Goä¸­ï¼Œ

- æ•°ç»„æ˜¯å€¼ã€‚å°†ä¸€ä¸ªæ•°ç»„èµ‹äºˆå¦ä¸€ä¸ªæ•°ç»„ä¼šå¤åˆ¶å…¶æ‰€æœ‰å…ƒç´ ã€‚
- ç‰¹åˆ«åœ°ï¼Œè‹¥å°†æŸä¸ªæ•°ç»„ä¼ å…¥æŸä¸ªå‡½æ•°ï¼Œå®ƒå°†æ¥æ”¶åˆ°è¯¥æ•°ç»„çš„ä¸€ä»½**å‰¯æœ¬**è€ŒéæŒ‡é’ˆã€‚
- æ•°ç»„çš„å¤§å°æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚ç±»å‹ `[10]int` å’Œ `[20]int` æ˜¯ä¸åŒçš„ã€‚

æ•°ç»„ä¸ºå€¼çš„å±æ€§å¾ˆæœ‰ç”¨ï¼Œä½†ä»£ä»·é«˜æ˜‚ï¼›è‹¥ä½ æƒ³è¦Cé‚£æ ·çš„è¡Œä¸ºå’Œæ•ˆç‡ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªæŒ‡å‘è¯¥æ•°ç»„çš„æŒ‡é’ˆã€‚

### åˆ‡ç‰‡ [:]

åˆ‡ç‰‡ä¿å­˜äº†å¯¹åº•å±‚æ•°ç»„çš„å¼•ç”¨ï¼Œè‹¥ä½ å°†æŸä¸ªåˆ‡ç‰‡èµ‹äºˆå¦ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒä»¬ä¼šå¼•ç”¨åŒä¸€ä¸ªæ•°ç»„ã€‚ è‹¥æŸä¸ªå‡½æ•°å°†ä¸€ä¸ªåˆ‡ç‰‡ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œåˆ™å®ƒå¯¹è¯¥åˆ‡ç‰‡å…ƒç´ çš„ä¿®æ”¹å¯¹è°ƒç”¨è€…è€Œè¨€åŒæ ·å¯è§ï¼Œ è¿™å¯ä»¥ç†è§£ä¸ºä¼ é€’äº†åº•å±‚æ•°ç»„çš„æŒ‡é’ˆã€‚åªè¦åˆ‡ç‰‡ä¸è¶…å‡ºåº•å±‚æ•°ç»„çš„é™åˆ¶ï¼Œå®ƒçš„é•¿åº¦å°±æ˜¯å¯å˜çš„ï¼Œåªéœ€å°†å®ƒèµ‹äºˆå…¶è‡ªèº«çš„åˆ‡ç‰‡å³å¯

#### äºŒç»´åˆ‡ç‰‡ [:] [:]

ä¸€ç§å°±æ˜¯ç‹¬ç«‹åœ°åˆ†é…æ¯ä¸€ä¸ªåˆ‡ç‰‡ï¼›è€Œå¦ä¸€ç§å°±æ˜¯åªåˆ†é…ä¸€ä¸ªæ•°ç»„ï¼Œ å°†å„ä¸ªåˆ‡ç‰‡éƒ½æŒ‡å‘å®ƒã€‚é‡‡ç”¨å“ªç§æ–¹å¼å–å†³äºä½ çš„åº”ç”¨ã€‚è‹¥åˆ‡ç‰‡ä¼šå¢é•¿æˆ–æ”¶ç¼©ï¼Œ å°±åº”è¯¥é€šè¿‡ç‹¬ç«‹åˆ†é…æ¥é¿å…è¦†ç›–ä¸‹ä¸€è¡Œï¼›è‹¥ä¸ä¼šï¼Œç”¨å•æ¬¡åˆ†é…æ¥æ„é€ å¯¹è±¡ä¼šæ›´åŠ é«˜æ•ˆã€‚ ä»¥ä¸‹æ˜¯è¿™ä¸¤ç§æ–¹æ³•çš„å¤§æ¦‚ä»£ç ï¼Œä»…ä¾›å‚è€ƒã€‚é¦–å…ˆæ˜¯ä¸€æ¬¡ä¸€è¡Œçš„ï¼š

```go
// åˆ†é…é¡¶å±‚åˆ‡ç‰‡ã€‚
picture := make([][]uint8, YSize) // æ¯ y ä¸ªå•å…ƒä¸€è¡Œã€‚
// éå†è¡Œï¼Œä¸ºæ¯ä¸€è¡Œéƒ½åˆ†é…åˆ‡ç‰‡
for i := range picture {
	picture[i] = make([]uint8, XSize)
}
```

ç°åœ¨æ˜¯ä¸€æ¬¡åˆ†é…ï¼Œå¯¹è¡Œè¿›è¡Œåˆ‡ç‰‡ï¼š

```go
// åˆ†é…é¡¶å±‚åˆ‡ç‰‡ï¼Œå’Œå‰é¢ä¸€æ ·ã€‚
picture := make([][]uint8, YSize) // æ¯ y ä¸ªå•å…ƒä¸€è¡Œã€‚
// åˆ†é…ä¸€ä¸ªå¤§çš„åˆ‡ç‰‡æ¥ä¿å­˜æ‰€æœ‰åƒç´ 
pixels := make([]uint8, XSize*YSize) // æ‹¥æœ‰ç±»å‹ []uint8ï¼Œå°½ç®¡å›¾ç‰‡æ˜¯ [][]uint8.
// éå†è¡Œï¼Œä»å‰©ä½™åƒç´ åˆ‡ç‰‡çš„å‰é¢åˆ‡å‡ºæ¯è¡Œæ¥ã€‚
for i := range picture {
	picture[i], pixels = pixels[:XSize], pixels[XSize:]
}
```

### æ˜ å°„ map[key T] value T

æ˜ å°„çš„é”®å¯ä»¥æ˜¯ä»»ä½•ç›¸ç­‰æ€§æ“ä½œç¬¦æ”¯æŒçš„ç±»å‹ï¼Œ å¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°ã€å­—ç¬¦ä¸²ã€æŒ‡é’ˆã€æ¥å£ï¼ˆåªè¦å…¶åŠ¨æ€ç±»å‹æ”¯æŒç›¸ç­‰æ€§åˆ¤æ–­ï¼‰ã€ç»“æ„ä»¥åŠæ•°ç»„ã€‚ åˆ‡ç‰‡ä¸èƒ½ç”¨ä½œæ˜ å°„é”®ï¼Œå› ä¸ºå®ƒä»¬çš„ç›¸ç­‰æ€§è¿˜æœªå®šä¹‰ã€‚ä¸åˆ‡ç‰‡ä¸€æ ·ï¼Œæ˜ å°„ä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ã€‚ è‹¥å°†æ˜ å°„ä¼ å…¥å‡½æ•°ä¸­ï¼Œå¹¶æ›´æ”¹äº†è¯¥æ˜ å°„çš„å†…å®¹ï¼Œåˆ™æ­¤ä¿®æ”¹å¯¹è°ƒç”¨è€…åŒæ ·å¯è§ã€‚

è‹¥è¯•å›¾é€šè¿‡æ˜ å°„ä¸­ä¸å­˜åœ¨çš„é”®æ¥å–å€¼ï¼Œå°±ä¼šè¿”å›ä¸è¯¥æ˜ å°„ä¸­é¡¹çš„ç±»å‹å¯¹åº”çš„é›¶å€¼ã€‚ ä¾‹å¦‚ï¼Œè‹¥æŸä¸ªæ˜ å°„åŒ…å«æ•´æ•°ï¼Œå½“æŸ¥æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„é”®æ—¶ä¼šè¿”å› `0`ã€‚æœ‰æ—¶ä½ éœ€è¦åŒºåˆ†æŸé¡¹æ˜¯ä¸å­˜åœ¨è¿˜æ˜¯å…¶å€¼ä¸ºé›¶å€¼ã€‚å¦‚å¯¹äºä¸€ä¸ªå€¼æœ¬åº”ä¸ºé›¶çš„ `"UTC"` æ¡ç›®ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”±äºä¸å­˜åœ¨è¯¥é¡¹è€Œå¾—åˆ°é›¶å€¼ã€‚ä½ å¯ä»¥ä½¿ç”¨å¤šé‡èµ‹å€¼çš„å½¢å¼æ¥åˆ†è¾¨è¿™ç§æƒ…å†µã€‚

```go
var seconds int
var ok bool
seconds, ok = timeZone[tz]
```

è¦åˆ é™¤æ˜ å°„ä¸­çš„æŸé¡¹ï¼Œå¯ä½¿ç”¨å†…å»ºå‡½æ•° `delete`ï¼Œå®ƒä»¥æ˜ å°„åŠè¦è¢«åˆ é™¤çš„é”®ä¸ºå®å‚ã€‚ å³ä¾¿å¯¹åº”çš„é”®ä¸åœ¨è¯¥æ˜ å°„ä¸­ï¼Œæ­¤æ“ä½œä¹Ÿæ˜¯å®‰å…¨çš„ã€‚

```go
delete(timeZone, "PDT")  // ç°åœ¨ç”¨æ ‡å‡†æ—¶é—´
```

### æ‰“å° :printer:

#### `fmt.Printf()`

è‹¥ä½ åªæƒ³è¦é»˜è®¤çš„è½¬æ¢ï¼Œå¦‚ä½¿ç”¨åè¿›åˆ¶çš„æ•´æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨é€šç”¨çš„æ ¼å¼ `%v`ï¼ˆå¯¹åº”â€œå€¼â€ï¼‰ï¼›å…¶ç»“æœä¸ `Print` å’Œ `Println` çš„è¾“å‡ºå®Œå…¨ç›¸åŒã€‚æ­¤å¤–ï¼Œè¿™ç§æ ¼å¼è¿˜èƒ½æ‰“å°**ä»»æ„**å€¼ï¼Œç”šè‡³åŒ…æ‹¬æ•°ç»„ã€ç»“æ„ä½“å’Œæ˜ å°„ã€‚ ä»¥ä¸‹æ˜¯æ‰“å°ä¸Šä¸€èŠ‚ä¸­å®šä¹‰çš„æ—¶åŒºæ˜ å°„çš„è¯­å¥ã€‚

```go
fmt.Printf("%v\n", timeZone)  // æˆ–åªç”¨ fmt.Println(timeZone)
```

è¿™ä¼šè¾“å‡º

```go
map[CST:-21600 PST:-28800 EST:-18000 UTC:0 MST:-25200]
```

å½“ç„¶ï¼Œæ˜ å°„ä¸­çš„é”®å¯èƒ½æŒ‰ä»»æ„é¡ºåºè¾“å‡ºã€‚å½“æ‰“å°ç»“æ„ä½“æ—¶ï¼Œæ”¹è¿›çš„æ ¼å¼ `%+v` ä¼šä¸ºç»“æ„ä½“çš„æ¯ä¸ªå­—æ®µæ·»ä¸Šå­—æ®µåï¼Œè€Œå¦ä¸€ç§æ ¼å¼ `%#v` å°†å®Œå…¨æŒ‰ç…§Goçš„è¯­æ³•æ‰“å°å€¼ã€‚

```go
type T struct {
	a int
	b float64
	c string
}
t := &T{ 7, -2.35, "abc\tdef" }
fmt.Printf("%v\n", t)
fmt.Printf("%+v\n", t)
fmt.Printf("%#v\n", t)
fmt.Printf("%#v\n", timeZone)
>>>>>
&{7 -2.35 abc   def}
&{a:7 b:-2.35 c:abc     def}
&main.T{a:7, b:-2.35, c:"abc\tdef"}
map[string] int{"CST":-21600, "PST":-28800, "EST":-18000, "UTC":0, "MST":-25200}
```

å¦ä¸€ç§å®ç”¨çš„æ ¼å¼æ˜¯ `%T`ï¼Œå®ƒä¼šæ‰“å°æŸä¸ªå€¼çš„**ç±»å‹**ã€‚

#### `fmt.Sprintf()`

è‹¥ä½ æƒ³æ§åˆ¶è‡ªå®šä¹‰ç±»å‹çš„é»˜è®¤æ ¼å¼ï¼Œåªéœ€ä¸ºè¯¥ç±»å‹å®šä¹‰ä¸€ä¸ªå…·æœ‰ `String() string` ç­¾åçš„æ–¹æ³•ã€‚è¯·å‹¿é€šè¿‡è°ƒç”¨ `Sprintf` æ¥æ„é€  `String` æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¼šæ— é™é€’å½’ä½ çš„çš„ `String` æ–¹æ³•ã€‚

```go
type MyString string

func (m MyString) String() string {
	return fmt.Sprintf("MyString=%s", m) // é”™è¯¯ï¼šä¼šæ— é™é€’å½’
}
```

### è¿½åŠ  :put_litter_in_its_place:

`append` ä¼šåœ¨åˆ‡ç‰‡æœ«å°¾è¿½åŠ å…ƒç´ å¹¶è¿”å›ç»“æœã€‚æˆ‘ä»¬å¿…é¡»è¿”å›ç»“æœï¼Œ åŸå› ä¸æˆ‘ä»¬æ‰‹å†™çš„ `Append` ä¸€æ ·ï¼Œå³åº•å±‚æ•°ç»„å¯èƒ½ä¼šè¢«æ”¹å˜ã€‚ä½†å¦‚æœæˆ‘ä»¬è¦åƒ `Append` é‚£æ ·å°†ä¸€ä¸ªåˆ‡ç‰‡è¿½åŠ åˆ°å¦ä¸€ä¸ªåˆ‡ç‰‡ä¸­å‘¢ï¼Ÿ å¾ˆç®€å•ï¼šåœ¨è°ƒç”¨çš„åœ°æ–¹ä½¿ç”¨ `...`ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢è°ƒç”¨ `Output` é‚£æ ·ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µçš„è¾“å‡ºä¸ä¸Šä¸€ä¸ªç›¸åŒã€‚

```go
x := []int{1,2,3}
y := []int{4,5,6}
x = append(x, y...)
fmt.Println(x)
```

å¦‚æœæ²¡æœ‰ `...`ï¼Œå®ƒå°±ä¼šç”±äºç±»å‹é”™è¯¯è€Œæ— æ³•ç¼–è¯‘ï¼Œå› ä¸º `y` ä¸æ˜¯ `int` ç±»å‹çš„ã€‚

## åˆå§‹åŒ– ` init()`

æœ€åï¼Œæ¯ä¸ªæºæ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡å®šä¹‰è‡ªå·±çš„æ— å‚æ•° `init` å‡½æ•°æ¥è®¾ç½®ä¸€äº›å¿…è¦çš„çŠ¶æ€ã€‚ ï¼ˆå…¶å®æ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥æ‹¥æœ‰å¤šä¸ª `init` å‡½æ•°ã€‚ï¼‰è€Œå®ƒçš„ç»“æŸå°±æ„å‘³ç€åˆå§‹åŒ–ç»“æŸï¼š åªæœ‰è¯¥åŒ…ä¸­çš„æ‰€æœ‰å˜é‡å£°æ˜éƒ½é€šè¿‡å®ƒä»¬çš„åˆå§‹åŒ–å™¨æ±‚å€¼å `init` æ‰ä¼šè¢«è°ƒç”¨ï¼Œ è€Œé‚£äº› `init` åªæœ‰åœ¨æ‰€æœ‰å·²å¯¼å…¥çš„åŒ…éƒ½è¢«åˆå§‹åŒ–åæ‰ä¼šè¢«æ±‚å€¼ã€‚

==é™¤äº†é‚£äº›ä¸èƒ½è¢«è¡¨ç¤ºæˆå£°æ˜çš„åˆå§‹åŒ–å¤–ï¼Œ`init` å‡½æ•°è¿˜å¸¸è¢«ç”¨åœ¨ç¨‹åºçœŸæ­£å¼€å§‹æ‰§è¡Œå‰ï¼Œæ£€éªŒæˆ–æ ¡æ­£ç¨‹åºçš„çŠ¶æ€ã€‚==

## æŒ‡é’ˆ Vs å€¼ *

ä»¥æŒ‡é’ˆæˆ–å€¼ä¸ºæ¥æ”¶è€…çš„åŒºåˆ«åœ¨äºï¼šå€¼æ–¹æ³•å¯é€šè¿‡æŒ‡é’ˆå’Œå€¼è°ƒç”¨ï¼Œ è€ŒæŒ‡é’ˆæ–¹æ³•åªèƒ½é€šè¿‡æŒ‡é’ˆæ¥è°ƒç”¨ã€‚ä½†è‹¥è¯¥å€¼æ˜¯å¯å¯»å€çš„ï¼Œ é‚£ä¹ˆè¯¥è¯­è¨€å°±ä¼šè‡ªåŠ¨æ’å…¥å–å€æ“ä½œç¬¦æ¥å¯¹ä»˜ä¸€èˆ¬çš„é€šè¿‡å€¼è°ƒç”¨çš„æŒ‡é’ˆæ–¹æ³•ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå˜é‡ `b` æ˜¯å¯å¯»å€çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€é€šè¿‡ `b.Write` æ¥è°ƒç”¨å®ƒçš„ `Write` æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå°†å®ƒé‡å†™ä¸º `(&b).Write`ã€‚

## æ¥å£ ä¸ å…¶ä»–ç±»å‹ T

### ç±»å‹æ–­è¨€ `t T.(typeName)`

è‹¥æˆ‘ä»¬çŸ¥é“è¯¥å€¼æ‹¥æœ‰ä¸€ä¸ª `string` è€Œæƒ³è¦æå–å®ƒå‘¢ï¼Ÿ åªéœ€ä¸€ç§æƒ…å†µçš„ç±»å‹é€‰æ‹©å°±è¡Œï¼Œä½†å®ƒéœ€è¦**ç±»å‹æ–­è¨€**ã€‚ç±»å‹æ–­è¨€æ¥å—ä¸€ä¸ªæ¥å£å€¼ï¼Œ å¹¶ä»ä¸­æå–æŒ‡å®šçš„æ˜ç¡®ç±»å‹çš„å€¼ã€‚å…¶è¯­æ³•å€Ÿé‰´è‡ªç±»å‹é€‰æ‹©å¼€å¤´çš„å­å¥ï¼Œä½†å®ƒéœ€è¦ä¸€ä¸ªæ˜ç¡®çš„ç±»å‹ï¼Œ è€Œé `type` å…³é”®å­—ï¼š

```go
var value interface{} // è°ƒç”¨è€…æä¾›çš„å€¼ã€‚
value.(typeName)
```

è€Œå…¶ç»“æœåˆ™æ˜¯æ‹¥æœ‰é™æ€ç±»å‹ `typeName` çš„æ–°å€¼ã€‚è¯¥ç±»å‹å¿…é¡»ä¸ºè¯¥æ¥å£æ‰€æ‹¥æœ‰çš„å…·ä½“ç±»å‹ï¼Œ æˆ–è€…è¯¥å€¼å¯è½¬æ¢æˆçš„ç¬¬äºŒç§æ¥å£ç±»å‹ã€‚è¦æå–æˆ‘ä»¬çŸ¥é“åœ¨è¯¥å€¼ä¸­çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿™æ ·ï¼š

```go
str := value.(string)
```

ä½†è‹¥å®ƒæ‰€è½¬æ¢çš„å€¼ä¸­ä¸åŒ…å«å­—ç¬¦ä¸²ï¼Œè¯¥ç¨‹åºå°±ä¼šä»¥è¿è¡Œæ—¶é”™è¯¯å´©æºƒã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œ éœ€ä½¿ç”¨â€œé€—å·, okâ€æƒ¯ç”¨æµ‹è¯•å®ƒèƒ½å®‰å…¨åœ°åˆ¤æ–­è¯¥å€¼æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼š

```go
str, ok := value.(string)
if ok {
	fmt.Printf("å­—ç¬¦ä¸²å€¼ä¸º %q\n", str)
} else {
	fmt.Printf("è¯¥å€¼éå­—ç¬¦ä¸²\n")
}
```

==è‹¥ç±»å‹æ–­è¨€å¤±è´¥ï¼Œ`str` å°†ç»§ç»­å­˜åœ¨ä¸”ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä½†å®ƒå°†æ‹¥æœ‰é›¶å€¼ï¼Œå³ç©ºå­—ç¬¦ä¸²ã€‚==

### é€šç”¨æ€§ :dollar:

è‹¥æŸç§ç°æœ‰çš„ç±»å‹ä»…å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œä¸”é™¤æ­¤ä¹‹å¤–å¹¶æ— å¯å¯¼å‡ºçš„æ–¹æ³•ï¼Œåˆ™è¯¥ç±»å‹æœ¬èº«å°±æ— éœ€å¯¼å‡ºã€‚ ä»…å¯¼å‡ºè¯¥æ¥å£èƒ½è®©æˆ‘ä»¬æ›´ä¸“æ³¨äºå…¶è¡Œä¸ºè€Œéå®ç°ï¼Œå…¶å®ƒå±æ€§ä¸åŒçš„å®ç°åˆ™èƒ½é•œåƒè¯¥åŸå§‹ç±»å‹çš„è¡Œä¸ºã€‚ è¿™ä¹Ÿèƒ½å¤Ÿé¿å…ä¸ºæ¯ä¸ªé€šç”¨æ¥å£çš„å®ä¾‹é‡å¤ç¼–å†™æ–‡æ¡£ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ„é€ å‡½æ•°åº”å½“è¿”å›ä¸€ä¸ªæ¥å£å€¼è€Œéå®ç°çš„ç±»å‹ã€‚ä¾‹å¦‚åœ¨ `hash` åº“ä¸­ï¼Œ`crc32.NewIEEE` å’Œ `adler32.New` éƒ½è¿”å›æ¥å£ç±»å‹ `hash.Hash32`ã€‚è¦åœ¨Goç¨‹åºä¸­ç”¨Adler-32ç®—æ³•æ›¿ä»£CRC-32ï¼Œ åªéœ€ä¿®æ”¹æ„é€ å‡½æ•°è°ƒç”¨å³å¯ï¼Œå…¶ä½™ä»£ç åˆ™ä¸å—ç®—æ³•æ”¹å˜çš„å½±å“ã€‚

å¯ç†è§£ä¸ºJavaä¸­çš„å¤šæ€ï¼Œå³è¿”å›çˆ¶æ¥å£ç±»å‹ï¼Œç”¨äºå±è”½ä¸åŒå­ç±»å®ç°çš„é€šç”¨æ–¹æ³•çš„å·®å¼‚

### æ¥å£å’Œæ–¹æ³•

æˆ‘ä»¬å¯ä»¥ä¸ºé™¤æŒ‡é’ˆå’Œæ¥å£ä»¥å¤–çš„ä»»ä½•ç±»å‹å®šä¹‰æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿèƒ½ä¸ºä¸€ä¸ªå‡½æ•°å†™ä¸€ä¸ªæ–¹æ³•ã€‚ `http` åŒ…åŒ…å«ä»¥ä¸‹ä»£ç ï¼š

```go
// HandlerFunc ç±»å‹æ˜¯ä¸€ä¸ªé€‚é…å™¨ï¼Œå®ƒå…è®¸å°†æ™®é€šå‡½æ•°ç”¨åšHTTPå¤„ç†ç¨‹åºã€‚
// è‹¥ f æ˜¯ä¸ªå…·æœ‰é€‚å½“ç­¾åçš„å‡½æ•°ï¼ŒHandlerFunc(f) å°±æ˜¯ä¸ªè°ƒç”¨ f çš„å¤„ç†ç¨‹åºå¯¹è±¡ã€‚
type HandlerFunc func(ResponseWriter, *Request)

// ServeHTTP calls f(c, req).
func (f HandlerFunc) ServeHTTP(w ResponseWriter, req *Request) {
	f(w, req)
}
```

`HandlerFunc` æ˜¯ä¸ªå…·æœ‰ `ServeHTTP` æ–¹æ³•çš„ç±»å‹ï¼Œ å› æ­¤è¯¥ç±»å‹çš„å€¼å°±èƒ½å¤„ç†HTTPè¯·æ±‚ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹è¯¥æ–¹æ³•çš„å®ç°ï¼šæ¥æ”¶è€…æ˜¯ä¸€ä¸ªå‡½æ•° `f`ï¼Œè€Œè¯¥æ–¹æ³•è°ƒç”¨ `f`ã€‚è¿™çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†ä¸å¿…å¤§æƒŠå°æ€ªï¼Œ åŒºåˆ«åœ¨äºæ¥æ”¶è€…å˜æˆäº†ä¸€ä¸ªä¿¡é“ï¼Œè€Œæ–¹æ³•é€šè¿‡è¯¥ä¿¡é“å‘é€æ¶ˆæ¯ã€‚

ä¸ºäº†å°† `ArgServer` å®ç°æˆHTTPæœåŠ¡å™¨ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—è®©å®ƒæ‹¥æœ‰åˆé€‚çš„ç­¾åã€‚

```go
// å®å‚æœåŠ¡å™¨ã€‚
func ArgServer(w http.ResponseWriter, req *http.Request) {
	fmt.Fprintln(w, os.Args)
}
```

`ArgServer` å’Œ `HandlerFunc` ç°åœ¨æ‹¥æœ‰äº†ç›¸åŒçš„ç­¾åï¼Œ å› æ­¤æˆ‘ä»¬å¯å°†å…¶è½¬æ¢ä¸ºè¿™ç§ç±»å‹ä»¥è®¿é—®å®ƒçš„æ–¹æ³•ï¼Œå°±åƒæˆ‘ä»¬å°† `Sequence` è½¬æ¢ä¸º `IntSlice` ä»¥è®¿é—® `IntSlice.Sort` é‚£æ ·ã€‚ å»ºç«‹ä»£ç éå¸¸ç®€å•ï¼š

```go
http.Handle("/args", http.HandlerFunc(ArgServer))
```

å½“æœ‰äººè®¿é—® `/args` é¡µé¢æ—¶ï¼Œå®‰è£…åˆ°è¯¥é¡µé¢çš„å¤„ç†ç¨‹åºå°±æœ‰äº†å€¼ `ArgServer` å’Œç±»å‹ `HandlerFunc`ã€‚ HTTPæœåŠ¡å™¨ä¼šä»¥ `ArgServer` ä¸ºæ¥æ”¶è€…ï¼Œè°ƒç”¨è¯¥ç±»å‹çš„ `ServeHTTP` æ–¹æ³•ï¼Œå®ƒä¼šåè¿‡æ¥è°ƒç”¨ `ArgServer`ï¼ˆé€šè¿‡ `f(c, req)`ï¼‰ï¼Œæ¥ç€å®å‚å°±ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ã€‚

##  ç©ºç™½æ ‡è¯†ç¬¦ _

### ç”¨äºåœ¨è°ƒè¯•æ—¶é¿å…ç¼–è¯‘é”™è¯¯ :bug:

è¦è®©ç¼–è¯‘å™¨åœæ­¢å…³äºæœªä½¿ç”¨å¯¼å…¥çš„æŠ±æ€¨ï¼Œéœ€è¦ç©ºç™½æ ‡è¯†ç¬¦æ¥å¼•ç”¨å·²å¯¼å…¥åŒ…ä¸­çš„ç¬¦å·ã€‚
 åŒæ ·ï¼Œå°†æœªä½¿ç”¨çš„å˜é‡ `fd` èµ‹äºˆç©ºç™½æ ‡è¯†ç¬¦ä¹Ÿèƒ½å…³é—­æœªä½¿ç”¨å˜é‡é”™è¯¯ã€‚ è¯¥ç¨‹åºçš„ä»¥ä¸‹ç‰ˆæœ¬å¯ä»¥ç¼–è¯‘ã€‚

```go
package main

import (
    "fmt"
    "io"
    "log"
    "os"
)

var _ = fmt.Printf // For debugging; delete when done. // ç”¨äºè°ƒè¯•ï¼Œç»“æŸæ—¶åˆ é™¤ã€‚
var _ io.Reader    // For debugging; delete when done. // ç”¨äºè°ƒè¯•ï¼Œç»“æŸæ—¶åˆ é™¤ã€‚

func main() {
    fd, err := os.Open("test.go")
    if err != nil {
        log.Fatal(err)
    }
    // TODO: use fd.
    _ = fd
}
```

æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬åº”åœ¨å¯¼å…¥å¹¶åŠ ä»¥æ³¨é‡Šåï¼Œå†ä½¿å…¨å±€å£°æ˜å¯¼å…¥é”™è¯¯é™é»˜ï¼Œè¿™æ ·å¯ä»¥è®©å®ƒä»¬æ›´æ˜“æ‰¾åˆ°ï¼Œ å¹¶ä½œä¸ºä»¥åæ¸…ç†å®ƒçš„æé†’ã€‚

## **==å†…åµŒ==** :bulb:

Goå¹¶ä¸æä¾›å…¸å‹çš„ï¼Œç±»å‹é©±åŠ¨çš„å­ç±»åŒ–æ¦‚å¿µï¼Œä½†é€šè¿‡å°†ç±»å‹<**å†…åµŒ**åˆ°ç»“æ„ä½“æˆ–æ¥å£ä¸­ï¼Œ å®ƒå°±èƒ½â€œå€Ÿé‰´â€éƒ¨åˆ†å®ç°ã€‚

æ¥å£å†…åµŒéå¸¸ç®€å•ã€‚æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ `io.Reader` å’Œ `io.Writer` æ¥å£ï¼Œè¿™é‡Œæ˜¯å®ƒä»¬çš„å®šä¹‰ã€‚

```go
type Reader interface {
	Read(p []byte) (n int, err error)
}

type Writer interface {
	Write(p []byte) (n int, err error)
}
```

`io` åŒ…ä¹Ÿå¯¼å‡ºäº†ä¸€äº›å…¶å®ƒæ¥å£ï¼Œä»¥æ­¤æ¥é˜æ˜å¯¹è±¡æ‰€éœ€å®ç°çš„æ–¹æ³•ã€‚ ä¾‹å¦‚ `io.ReadWriter` å°±æ˜¯ä¸ªåŒ…å« `Read` å’Œ `Write` çš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ˜¾ç¤ºåœ°åˆ—å‡ºè¿™ä¸¤ä¸ªæ–¹æ³•æ¥æŒ‡æ˜ `io.ReadWriter`ï¼Œ ä½†é€šè¿‡å°†è¿™ä¸¤ä¸ªæ¥å£å†…åµŒåˆ°æ–°çš„æ¥å£ä¸­æ˜¾ç„¶æ›´å®¹æ˜“ä¸”æ›´å…·å¯å‘æ€§ï¼Œå°±åƒè¿™æ ·ï¼š

```go
// ReadWriter æ¥å£ç»“åˆäº† Reader å’Œ Writer æ¥å£ã€‚
type ReadWriter interface {
	Reader
	Writer
}
```

æ­£å¦‚å®ƒçœ‹èµ·æ¥é‚£æ ·ï¼š`ReadWriter` èƒ½å¤Ÿåšä»»ä½• `Reader` **å’Œ** `Writer` å¯ä»¥åšåˆ°çš„äº‹æƒ…ï¼Œå®ƒæ˜¯å†…åµŒæ¥å£çš„è”åˆä½“ ï¼ˆå®ƒä»¬å¿…é¡»æ˜¯ä¸ç›¸äº¤çš„æ–¹æ³•é›†ï¼‰ã€‚åªæœ‰æ¥å£èƒ½è¢«åµŒå…¥åˆ°æ¥å£ä¸­ã€‚

åŒæ ·çš„åŸºæœ¬æƒ³æ³•å¯ä»¥åº”ç”¨åœ¨ç»“æ„ä½“ä¸­ï¼Œä½†å…¶æ„ä¹‰æ›´åŠ æ·±è¿œã€‚`bufio` åŒ…ä¸­æœ‰ `bufio.Reader` å’Œ `bufio.Writer` è¿™ä¸¤ä¸ªç»“æ„ä½“ç±»å‹ï¼Œ å®ƒä»¬æ¯ä¸€ä¸ªéƒ½å®ç°äº†ä¸ `io` åŒ…ä¸­ç›¸åŒæ„ä¹‰çš„æ¥å£ã€‚æ­¤å¤–ï¼Œ`bufio` è¿˜é€šè¿‡ç»“åˆ `reader/writer` å¹¶å°†å…¶å†…åµŒåˆ°ç»“æ„ä½“ä¸­ï¼Œå®ç°äº†å¸¦ç¼“å†²çš„ `reader/writer`ï¼šå®ƒåˆ—å‡ºäº†ç»“æ„ä½“ä¸­çš„ç±»å‹ï¼Œä½†å¹¶æœªç»™äºˆå®ƒä»¬å­—æ®µåã€‚

```go
// ReadWriter å­˜å‚¨äº†æŒ‡å‘ Reader å’Œ Writer çš„æŒ‡é’ˆã€‚
// å®ƒå®ç°äº† io.ReadWriterã€‚
type ReadWriter struct {
	*Reader  // *bufio.Reader
	*Writer  // *bufio.Writer
}
```

å†…åµŒçš„å…ƒç´ ä¸ºæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå½“ç„¶å®ƒä»¬åœ¨ä½¿ç”¨å‰å¿…é¡»è¢«åˆå§‹åŒ–ä¸ºæŒ‡å‘æœ‰æ•ˆç»“æ„ä½“çš„æŒ‡é’ˆã€‚ `ReadWriter` ç»“æ„ä½“å’Œé€šè¿‡å¦‚ä¸‹æ–¹å¼å®šä¹‰ï¼š

```go
type ReadWriter struct {
	reader *Reader
	writer *Writer
}
```

ä½†ä¸ºäº†æå‡è¯¥å­—æ®µçš„æ–¹æ³•å¹¶æ»¡è¶³ `io` æ¥å£ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦æä¾›è½¬å‘çš„æ–¹æ³•ï¼Œ å°±åƒè¿™æ ·ï¼š

```go
func (rw *ReadWriter) Read(p []byte) (n int, err error) {
	return rw.reader.Read(p)
}
```

è€Œé€šè¿‡ç›´æ¥å†…åµŒç»“æ„ä½“ï¼Œæˆ‘ä»¬å°±èƒ½é¿å…å¦‚æ­¤ç¹çã€‚ å†…åµŒç±»å‹çš„æ–¹æ³•å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œè¿™æ„å‘³ç€ `bufio.ReadWriter` ä¸ä»…åŒ…æ‹¬ `bufio.Reader` å’Œ `bufio.Writer` çš„æ–¹æ³•ï¼Œå®ƒè¿˜åŒæ—¶æ»¡è¶³ä¸‹åˆ—ä¸‰ä¸ªæ¥å£ï¼š `io.Reader`ã€`io.Writer` ä»¥åŠ `io.ReadWriter`ã€‚

è¿˜æœ‰ç§åŒºåˆ†å†…åµŒä¸å­ç±»çš„é‡è¦æ‰‹æ®µã€‚å½“å†…åµŒä¸€ä¸ªç±»å‹æ—¶ï¼Œè¯¥ç±»å‹çš„æ–¹æ³•ä¼šæˆä¸ºå¤–éƒ¨ç±»å‹çš„æ–¹æ³•ï¼Œ ä½†å½“å®ƒä»¬è¢«è°ƒç”¨æ—¶ï¼Œè¯¥æ–¹æ³•çš„æ¥æ”¶è€…æ˜¯å†…éƒ¨ç±»å‹ï¼Œè€Œéå¤–éƒ¨çš„ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå½“ `bufio.ReadWriter` çš„ `Read` æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œ å®ƒä¸ä¹‹å‰å†™çš„è½¬å‘æ–¹æ³•å…·æœ‰åŒæ ·çš„æ•ˆæœï¼›æ¥æ”¶è€…æ˜¯ `ReadWriter` çš„ `reader` å­—æ®µï¼Œè€Œé `ReadWriter` æœ¬èº«ã€‚

å†…åµŒåŒæ ·å¯ä»¥æä¾›ä¾¿åˆ©ã€‚è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªå†…åµŒå­—æ®µå’Œä¸€ä¸ªå¸¸è§„çš„å‘½åå­—æ®µã€‚

```go
type Job struct {
	Command string
	*log.Logger
}
```

`Job` ç±»å‹ç°åœ¨æœ‰äº† `Log`ã€`Logf` å’Œ `*log.Logger` çš„å…¶å®ƒæ–¹æ³•ã€‚æˆ‘ä»¬å½“ç„¶å¯ä»¥ä¸º `Logger` æä¾›ä¸€ä¸ªå­—æ®µåï¼Œä½†å®Œå…¨ä¸å¿…è¿™ä¹ˆåšã€‚ç°åœ¨ï¼Œä¸€æ—¦åˆå§‹åŒ–åï¼Œæˆ‘ä»¬å°±èƒ½è®°å½• `Job` äº†ï¼š

```go
job.Log("starting now...")
```

`Logger` æ˜¯ `Job` ç»“æ„ä½“çš„å¸¸è§„å­—æ®µï¼Œ å› æ­¤æˆ‘ä»¬å¯åœ¨ `Job` çš„æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡ä¸€èˆ¬çš„æ–¹å¼æ¥åˆå§‹åŒ–å®ƒï¼Œå°±åƒè¿™æ ·ï¼š

```go
func NewJob(command string, logger *log.Logger) *Job {
	return &Job{command, logger}
}
```

æˆ–é€šè¿‡å¤åˆå­—é¢ï¼š

```go
job := &Job{command, log.New(os.Stderr, "Job: ", log.Ldate)}
```

è‹¥æˆ‘ä»¬éœ€è¦ç›´æ¥å¼•ç”¨å†…åµŒå­—æ®µï¼Œå¯ä»¥å¿½ç•¥åŒ…é™å®šåï¼Œç›´æ¥å°†è¯¥å­—æ®µçš„ç±»å‹åä½œä¸ºå­—æ®µåï¼Œ å°±åƒæˆ‘ä»¬åœ¨ `ReaderWriter` ç»“æ„ä½“çš„ `Read` æ–¹æ³•ä¸­åšçš„é‚£æ ·ã€‚ è‹¥æˆ‘ä»¬éœ€è¦è®¿é—® `Job` ç±»å‹çš„å˜é‡ `job` çš„ `*log.Logger`ï¼Œ å¯ä»¥ç›´æ¥å†™ä½œ `job.Logger`ã€‚è‹¥æˆ‘ä»¬æƒ³ç²¾ç‚¼ `Logger` çš„æ–¹æ³•æ—¶ï¼Œ è¿™ä¼šéå¸¸æœ‰ç”¨ã€‚

```go
func (job *Job) Logf(format string, args ...interface{}) {
	job.Logger.Logf("%q: %s", job.Command, fmt.Sprintf(format, args...))
}
```

å†…åµŒç±»å‹ä¼šå¼•å…¥å‘½åå†²çªçš„é—®é¢˜ï¼Œä½†è§£å†³è§„åˆ™å´å¾ˆç®€å•ã€‚é¦–å…ˆï¼Œå­—æ®µæˆ–æ–¹æ³• `X` ä¼šéšè—è¯¥ç±»å‹ä¸­æ›´æ·±å±‚åµŒå¥—çš„å…¶å®ƒé¡¹ `X`ã€‚è‹¥ `log.Logger` åŒ…å«ä¸€ä¸ªåä¸º `Command` çš„å­—æ®µæˆ–æ–¹æ³•ï¼Œ`Job` çš„ `Command` å­—æ®µä¼šè¦†ç›–å®ƒã€‚

å…¶æ¬¡ï¼Œè‹¥ç›¸åŒçš„åµŒå¥—å±‚çº§ä¸Šå‡ºç°åŒåå†²çªï¼Œé€šå¸¸ä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚è‹¥ `Job` ç»“æ„ä½“ä¸­åŒ…å«åä¸º `Logger` çš„å­—æ®µæˆ–æ–¹æ³•ï¼Œå†å°† `log.Logger` å†…åµŒåˆ°å…¶ä¸­çš„è¯å°±ä¼šäº§ç”Ÿé”™è¯¯ã€‚ç„¶è€Œï¼Œè‹¥é‡åæ°¸è¿œä¸ä¼šåœ¨è¯¥ç±»å‹å®šä¹‰ä¹‹å¤–çš„ç¨‹åºä¸­ä½¿ç”¨ï¼Œé‚£å°±ä¸ä¼šå‡ºé”™ã€‚ è¿™ç§é™å®šèƒ½å¤Ÿåœ¨å¤–éƒ¨åµŒå¥—ç±»å‹å‘ç”Ÿä¿®æ”¹æ—¶æä¾›æŸç§ä¿æŠ¤ã€‚ å› æ­¤ï¼Œå°±ç®—æ·»åŠ çš„å­—æ®µä¸å¦ä¸€ä¸ªå­ç±»å‹ä¸­çš„å­—æ®µç›¸å†²çªï¼Œåªè¦è¿™ä¸¤ä¸ªç›¸åŒçš„å­—æ®µæ°¸è¿œä¸ä¼šè¢«ä½¿ç”¨å°±æ²¡é—®é¢˜ã€‚

## å¹¶å‘ :twisted_rightwards_arrows:

> ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œåº”é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ã€‚

### ä¿¡é“ <-

å°½ç®¡åªæœ‰ `MaxOutstanding` ä¸ªGoç¨‹èƒ½åŒæ—¶è¿è¡Œï¼Œä½† `Serve` è¿˜æ˜¯ä¸ºæ¯ä¸ªè¿›å…¥çš„è¯·æ±‚éƒ½åˆ›å»ºäº†æ–°çš„Goç¨‹ã€‚å…¶ç»“æœå°±æ˜¯ï¼Œè‹¥è¯·æ±‚æ¥å¾—å¾ˆå¿«ï¼Œ è¯¥ç¨‹åºå°±ä¼šæ— é™åœ°æ¶ˆè€—èµ„æºã€‚ä¸ºäº†å¼¥è¡¥è¿™ç§ä¸è¶³ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ `Serve` æ¥é™åˆ¶åˆ›å»ºGoç¨‹ï¼Œè¿™æ˜¯ä¸ªæ˜æ˜¾çš„è§£å†³æ–¹æ¡ˆï¼Œä½†è¦å½“å¿ƒæˆ‘ä»¬ä¿®å¤åå‡ºç°çš„Bugã€‚

```go
func Serve(queue chan *Request) {
	for req := range queue {
		sem <- 1
		go func() {
			process(req) // è¿™å„¿æœ‰Bugï¼Œè§£é‡Šè§ä¸‹ã€‚
			<-sem
		}()
	}
}
```

Bugå‡ºç°åœ¨Goçš„ `for` å¾ªç¯ä¸­ï¼Œè¯¥å¾ªç¯å˜é‡åœ¨æ¯æ¬¡è¿­ä»£æ—¶ä¼šè¢«é‡ç”¨ï¼Œå› æ­¤ `req` å˜é‡ä¼šåœ¨æ‰€æœ‰çš„Goç¨‹é—´å…±äº«ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿ `req` å¯¹äºæ¯ä¸ªGoç¨‹æ¥è¯´éƒ½æ˜¯å”¯ä¸€çš„ã€‚æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤Ÿåšåˆ°ï¼Œå°±æ˜¯å°† `req` çš„å€¼ä½œä¸ºå®å‚ä¼ å…¥åˆ°è¯¥Goç¨‹çš„é—­åŒ…ä¸­ï¼š

```go
func Serve(queue chan *Request) {
	for req := range queue {
		sem <- 1
		go func(req *Request) {
			process(req)
			<-sem
		}(req)
	}
}
```

æ¯”è¾ƒå‰åä¸¤ä¸ªç‰ˆæœ¬ï¼Œè§‚å¯Ÿè¯¥é—­åŒ…å£°æ˜å’Œè¿è¡Œä¸­çš„å·®åˆ«ã€‚ å¦ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯ä»¥ç›¸åŒçš„åå­—åˆ›å»ºæ–°çš„å˜é‡ï¼Œå¦‚ä¾‹ä¸­æ‰€ç¤ºï¼š

```go
func Serve(queue chan *Request) {
	for req := range queue {
		req := req // ä¸ºè¯¥Goç¨‹åˆ›å»º req çš„æ–°å®ä¾‹ã€‚
		sem <- 1
		go func() {
			process(req)
			<-sem
		}()
	}
}
```

### å¹¶è¡ŒåŒ–

è¿™äº›è®¾è®¡çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯åœ¨å¤šCPUæ ¸å¿ƒä¸Šå®ç°å¹¶è¡Œè®¡ç®—ã€‚å¦‚æœè®¡ç®—è¿‡ç¨‹èƒ½å¤Ÿè¢«åˆ†ä¸ºå‡ å— å¯ç‹¬ç«‹æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒå°±å¯ä»¥åœ¨æ¯å—è®¡ç®—ç»“æŸæ—¶å‘ä¿¡é“å‘é€ä¿¡å·ï¼Œä»è€Œå®ç°å¹¶è¡Œå¤„ç†ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªç†æƒ³åŒ–çš„ä¾‹å­ã€‚æˆ‘ä»¬åœ¨å¯¹ä¸€ç³»åˆ—å‘é‡é¡¹è¿›è¡Œæè€—èµ„æºçš„æ“ä½œï¼Œ è€Œæ¯ä¸ªé¡¹çš„å€¼è®¡ç®—æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚

```go
type Vector []float64

// å°†æ­¤æ“åº”ç”¨è‡³ v[i], v[i+1] ... ç›´åˆ° v[n-1]
func (v Vector) DoSome(i, n int, u Vector, c chan int) {
	for ; i < n; i++ {
		v[i] += u.Op(v[i])
	}
	c <- 1    // å‘ä¿¡å·è¡¨ç¤ºè¿™ä¸€å—è®¡ç®—å®Œæˆã€‚
}
```

æˆ‘ä»¬åœ¨å¾ªç¯ä¸­å¯åŠ¨äº†ç‹¬ç«‹çš„å¤„ç†å—ï¼Œæ¯ä¸ªCPUå°†æ‰§è¡Œä¸€ä¸ªå¤„ç†ã€‚ å®ƒä»¬æœ‰å¯èƒ½ä»¥ä¹±åºçš„å½¢å¼å®Œæˆå¹¶ç»“æŸï¼Œä½†è¿™æ²¡æœ‰å…³ç³»ï¼› æˆ‘ä»¬åªéœ€åœ¨æ‰€æœ‰Goç¨‹å¼€å§‹åæ¥æ”¶ï¼Œå¹¶ç»Ÿè®¡ä¿¡é“ä¸­çš„å®Œæˆä¿¡å·å³å¯ã€‚

```go
const NCPU = 4  // CPUæ ¸å¿ƒæ•°

func (v Vector) DoAll(u Vector) {
	c := make(chan int, NCPU)  // ç¼“å†²åŒºæ˜¯å¯é€‰çš„ï¼Œä½†æ˜æ˜¾ç”¨ä¸Šæ›´å¥½
	for i := 0; i < NCPU; i++ {
		go v.DoSome(i*len(v)/NCPU, (i+1)*len(v)/NCPU, u, c)
	}
	// æ’ç©ºä¿¡é“ã€‚
	for i := 0; i < NCPU; i++ {
		<-c    // ç­‰å¾…ä»»åŠ¡å®Œæˆ
	}
	// ä¸€åˆ‡å®Œæˆã€‚
}
```

ç›®å‰Goè¿è¡Œæ—¶çš„å®ç°é»˜è®¤å¹¶ä¸ä¼šå¹¶è¡Œæ‰§è¡Œä»£ç ï¼Œå®ƒåªä¸ºç”¨æˆ·å±‚ä»£ç æä¾›å•ä¸€çš„å¤„ç†æ ¸å¿ƒã€‚ ä»»æ„æ•°é‡çš„Goç¨‹éƒ½å¯èƒ½åœ¨ç³»ç»Ÿè°ƒç”¨ä¸­è¢«é˜»å¡ï¼Œè€Œ**åœ¨ä»»æ„æ—¶åˆ»é»˜è®¤åªæœ‰ä¸€ä¸ªä¼šæ‰§è¡Œç”¨æˆ·å±‚ä»£ç **ã€‚ å®ƒåº”å½“å˜å¾—æ›´æ™ºèƒ½ï¼Œè€Œä¸”å®ƒå°†æ¥è‚¯å®šä¼šå˜å¾—æ›´æ™ºèƒ½ã€‚ä½†ç°åœ¨ï¼Œè‹¥ä½ å¸Œæœ›CPUå¹¶è¡Œæ‰§è¡Œï¼Œ å°±å¿…é¡»å‘Šè¯‰è¿è¡Œæ—¶ä½ å¸Œæœ›åŒæ—¶æœ‰å¤šå°‘Goç¨‹èƒ½æ‰§è¡Œä»£ç ã€‚æœ‰ä¸¤ç§é€”å¾„å¯æ„è¯†å½¢æ€ï¼Œè¦ä¹ˆ åœ¨è¿è¡Œä½ çš„å·¥ä½œæ—¶å°† `GOMAXPROCS` ç¯å¢ƒå˜é‡è®¾ä¸ºä½ è¦ä½¿ç”¨çš„æ ¸å¿ƒæ•°ï¼Œ è¦ä¹ˆå¯¼å…¥ `runtime` åŒ…å¹¶è°ƒç”¨ `runtime.GOMAXPROCS(NCPU)`ã€‚ `runtime.NumCPU()` çš„å€¼å¯èƒ½å¾ˆæœ‰ç”¨ï¼Œå®ƒä¼šè¿”å›å½“å‰æœºå™¨çš„é€»è¾‘CPUæ ¸å¿ƒæ•°ã€‚ å½“ç„¶ï¼Œéšç€è°ƒåº¦ç®—æ³•å’Œè¿è¡Œæ—¶çš„æ”¹è¿›ï¼Œå°†æ¥ä¼šä¸å†éœ€è¦è¿™ç§æ–¹æ³•ã€‚

> æ³¨æ„ä¸è¦æ··æ·†å¹¶å‘å’Œå¹¶è¡Œçš„æ¦‚å¿µï¼šå¹¶å‘æ˜¯ç”¨å¯ç‹¬ç«‹æ‰§è¡Œçš„ç»„ä»¶æ„é€ ç¨‹åºçš„æ–¹æ³•ï¼Œ è€Œå¹¶è¡Œåˆ™æ˜¯ä¸ºäº†æ•ˆç‡åœ¨å¤šCPUä¸Šå¹³è¡Œåœ°è¿›è¡Œè®¡ç®—ã€‚å°½ç®¡Goçš„å¹¶å‘ç‰¹æ€§èƒ½å¤Ÿè®©æŸäº›é—®é¢˜æ›´æ˜“æ„é€ æˆå¹¶è¡Œè®¡ç®—ï¼Œ ä½†**Goä»ç„¶æ˜¯ç§å¹¶å‘è€Œéå¹¶è¡Œçš„è¯­è¨€**ï¼Œä¸”**Goçš„æ¨¡å‹å¹¶ä¸é€‚åˆæ‰€æœ‰çš„å¹¶è¡Œé—®é¢˜**ã€‚ å…³äºå…¶ä¸­åŒºåˆ«çš„è®¨è®ºï¼Œè§ [æ­¤åšæ–‡](http://blog.golang.org/2013/01/concurrency-is-not-parallelism.html)ã€‚

## é”™è¯¯ :no_entry:

### Error :warning:

é”™è¯¯å­—ç¬¦ä¸²åº”å°½å¯èƒ½åœ°æŒ‡æ˜å®ƒä»¬çš„æ¥æºï¼Œä¾‹å¦‚äº§ç”Ÿè¯¥é”™è¯¯çš„åŒ…åå‰ç¼€ã€‚ä¾‹å¦‚åœ¨ `image` åŒ…ä¸­ï¼Œç”±äºæœªçŸ¥æ ¼å¼å¯¼è‡´è§£ç é”™è¯¯çš„å­—ç¬¦ä¸²ä¸ºâ€œimage: unknown formatâ€ã€‚

`os.Open` å¯è¿”å›ä¸€ä¸ª `os.PathError`ã€‚

```go
// PathError è®°å½•ä¸€ä¸ªé”™è¯¯ä»¥åŠäº§ç”Ÿè¯¥é”™è¯¯çš„è·¯å¾„å’Œæ“ä½œã€‚
type PathError struct {
	Op string    // "open"ã€"unlink" ç­‰ç­‰ã€‚
	Path string  // ç›¸å…³è”çš„æ–‡ä»¶ã€‚
	Err error    // ç”±ç³»ç»Ÿè°ƒç”¨è¿”å›ã€‚
}

func (e *PathError) Error() string {
	return e.Op + " " + e.Path + ": " + e.Err.Error()
}

>>>>
open /etc/passwx: no such file or directory
```

è¿™ç§é”™è¯¯åŒ…å«äº†å‡ºé”™çš„æ–‡ä»¶åã€æ“ä½œå’Œè§¦å‘çš„æ“ä½œç³»ç»Ÿé”™è¯¯ï¼Œè¿™æ ·åœ¨äº§ç”Ÿè¯¥é”™è¯¯çš„è°ƒç”¨å’Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯ç›¸è·ç”šè¿œæ—¶ï¼Œå®ƒä¹Ÿä¼šéå¸¸æœ‰ç”¨ï¼Œè¿™æ¯”è‹ç™½çš„â€œä¸å­˜åœ¨è¯¥æ–‡ä»¶æˆ–ç›®å½•â€æ›´å…·è¯´æ˜æ€§ã€‚

### Panic :broken_heart:

å¦‚æœé”™è¯¯æ—¶ä¸å¯æ¢å¤çš„å‘¢ï¼Ÿæœ‰æ—¶ç¨‹åºå°±æ˜¯ä¸èƒ½ç»§ç»­è¿è¡Œã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æä¾›äº†å†…å»ºçš„ `panic` å‡½æ•°ï¼Œå®ƒä¼šäº§ç”Ÿä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯å¹¶ç»ˆæ­¢ç¨‹åºï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªä»»æ„ç±»å‹çš„å®å‚ï¼ˆä¸€èˆ¬ä¸ºå­—ç¬¦ä¸²ï¼‰ï¼Œå¹¶åœ¨ç¨‹åºç»ˆæ­¢æ—¶æ‰“å°ã€‚ å®ƒè¿˜èƒ½è¡¨æ˜å‘ç”Ÿäº†æ„æ–™ä¹‹å¤–çš„äº‹æƒ…ï¼Œæ¯”å¦‚ä»æ— é™å¾ªç¯ä¸­é€€å‡ºäº†ã€‚

å®é™…çš„åº“å‡½æ•°åº”é¿å… `panic`ã€‚è‹¥é—®é¢˜å¯ä»¥è¢«å±è”½æˆ–è§£å†³ï¼Œ æœ€å¥½å°±æ˜¯è®©ç¨‹åºç»§ç»­è¿è¡Œè€Œä¸æ˜¯ç»ˆæ­¢æ•´ä¸ªç¨‹åºã€‚ä¸€ä¸ªå¯èƒ½çš„åä¾‹å°±æ˜¯åˆå§‹åŒ–ï¼š è‹¥æŸä¸ªåº“çœŸçš„ä¸èƒ½è®©è‡ªå·±å·¥ä½œï¼Œä¸”æœ‰è¶³å¤Ÿç†ç”±äº§ç”ŸPanicï¼Œé‚£å°±ç”±å®ƒå»å§ã€‚

### Recover :hospital:

> å½“ `panic` è¢«è°ƒç”¨åï¼ˆåŒ…æ‹¬ä¸æ˜ç¡®çš„è¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚åˆ‡ç‰‡æ£€ç´¢è¶Šç•Œæˆ–ç±»å‹æ–­è¨€å¤±è´¥ï¼‰ï¼Œ ç¨‹åºå°†ç«‹åˆ»ç»ˆæ­¢å½“å‰å‡½æ•°çš„æ‰§è¡Œï¼Œå¹¶å¼€å§‹å›æº¯Goç¨‹çš„æ ˆï¼Œè¿è¡Œä»»ä½•è¢«æ¨è¿Ÿçš„å‡½æ•°ã€‚ è‹¥å›æº¯åˆ°è¾¾Goç¨‹æ ˆçš„é¡¶ç«¯ï¼Œç¨‹åºå°±ä¼šç»ˆæ­¢ã€‚**ä¸è¿‡æˆ‘ä»¬å¯ä»¥ç”¨å†…å»ºçš„ `recover` å‡½æ•°æ¥é‡æ–°æˆ–æ¥å–å›Goç¨‹çš„æ§åˆ¶æƒé™å¹¶ä½¿å…¶æ¢å¤æ­£å¸¸æ‰§è¡Œã€‚**

è°ƒç”¨ `recover` å°†åœæ­¢å›æº¯è¿‡ç¨‹ï¼Œå¹¶è¿”å›ä¼ å…¥ `panic` çš„å®å‚ã€‚ ç”±äºåœ¨å›æº¯æ—¶åªæœ‰è¢«æ¨è¿Ÿå‡½æ•°ä¸­çš„ä»£ç åœ¨è¿è¡Œï¼Œå› æ­¤ `recover` åªèƒ½åœ¨è¢«æ¨è¿Ÿçš„å‡½æ•°ä¸­æ‰æœ‰æ•ˆã€‚

`recover` çš„ä¸€ä¸ªåº”ç”¨å°±æ˜¯åœ¨æœåŠ¡å™¨ä¸­ç»ˆæ­¢å¤±è´¥çš„Goç¨‹è€Œæ— éœ€æ€æ­»å…¶å®ƒæ­£åœ¨æ‰§è¡Œçš„Goç¨‹ã€‚

```go
func server(workChan <-chan *Work) {
	for work := range workChan {
		go safelyDo(work)
	}
}

func safelyDo(work *Work) {
	defer func() {
		if err := recover(); err != nil {
			log.Println("work failed:", err)
		}
	}()
	do(work)
}
```

åœ¨æ­¤ä¾‹ä¸­ï¼Œè‹¥ `do(work)` è§¦å‘äº†Panicï¼Œå…¶ç»“æœå°±ä¼šè¢«è®°å½•ï¼Œ è€Œè¯¥Goç¨‹ä¼šè¢«å¹²å‡€åˆ©è½åœ°ç»“æŸï¼Œä¸ä¼šå¹²æ‰°åˆ°å…¶å®ƒGoç¨‹ã€‚æˆ‘ä»¬æ— éœ€åœ¨æ¨è¿Ÿçš„é—­åŒ…ä¸­åšä»»ä½•äº‹æƒ…ï¼Œ `recover` ä¼šå¤„ç†å¥½è¿™ä¸€åˆ‡ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ª `error` ç±»å‹çš„ `Error` æ–¹æ³•å’Œä¸€ä¸ª `Compile` å‡½æ•°çš„å®šä¹‰ï¼š

```go
// Error æ˜¯è§£æé”™è¯¯çš„ç±»å‹ï¼Œå®ƒæ»¡è¶³ error æ¥å£ã€‚
type Error string
func (e Error) Error() string {
	return string(e)
}

// error æ˜¯ *Regexp çš„æ–¹æ³•ï¼Œå®ƒé€šè¿‡ç”¨ä¸€ä¸ª Error è§¦å‘Panicæ¥æŠ¥å‘Šè§£æé”™è¯¯ã€‚
func (regexp *Regexp) error(err string) {
	panic(Error(err))
}

// Compile è¿”å›è¯¥æ­£åˆ™è¡¨è¾¾å¼è§£æåçš„è¡¨ç¤ºã€‚
func Compile(str string) (regexp *Regexp, err error) {
	regexp = new(Regexp)
	// doParse will panic if there is a parse error.
	defer func() {
		if e := recover(); e != nil {
			regexp = nil    // æ¸…ç†è¿”å›å€¼ã€‚
			err = e.(Error) // è‹¥å®ƒä¸æ˜¯è§£æé”™è¯¯ï¼Œå°†é‡æ–°è§¦å‘Panicã€‚
		}
	}()
	return regexp.doParse(str), nil
}
```

è‹¥ `doParse` è§¦å‘äº†Panicï¼Œæ¢å¤å—ä¼šå°†è¿”å›å€¼è®¾ä¸º `nil` ï¼Œ**å³è¢«æ¨è¿Ÿçš„å‡½æ•°èƒ½å¤Ÿä¿®æ”¹å·²å‘½åçš„è¿”å›å€¼**ã€‚åœ¨ `err` çš„èµ‹å€¼è¿‡ç¨‹ä¸­ï¼Œ æˆ‘ä»¬å°†é€šè¿‡æ–­è¨€å®ƒæ˜¯å¦æ‹¥æœ‰å±€éƒ¨ç±»å‹ `Error` æ¥æ£€æŸ¥å®ƒã€‚**è‹¥å®ƒæ²¡æœ‰ï¼Œ ç±»å‹æ–­è¨€å°†ä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œå¹¶ç»§ç»­æ ˆçš„å›æº¯ï¼Œä»¿ä½›ä¸€åˆ‡ä»æœªä¸­æ–­è¿‡ä¸€æ ·ã€‚** è¯¥æ£€æŸ¥æ„å‘³ç€è‹¥å‘ç”Ÿäº†ä¸€äº›åƒç´¢å¼•è¶Šç•Œä¹‹ç±»çš„æ„å¤–ï¼Œé‚£ä¹ˆå³ä¾¿æˆ‘ä»¬ä½¿ç”¨äº† `panic` å’Œ `recover` æ¥å¤„ç†è§£æé”™è¯¯ï¼Œä»£ç ä»ç„¶ä¼šå¤±è´¥ã€‚

## ä¸€ä¸ªWebæœåŠ¡å™¨ :tada:

> ä¸€ä¸ªWebæœåŠ¡å™¨ã€‚è¯¥ç¨‹åºå…¶å®åªæ˜¯ä¸ªWebæœåŠ¡å™¨çš„é‡ç”¨ã€‚ Googleåœ¨[http://chart.apis.google.com](http://chart.apis.google.com/) ä¸Šæä¾›äº†ä¸€ä¸ªå°†è¡¨å•æ•°æ®è‡ªåŠ¨è½¬æ¢ä¸ºå›¾è¡¨çš„æœåŠ¡ã€‚ä¸è¿‡ï¼Œè¯¥æœåŠ¡å¾ˆéš¾äº¤äº’ï¼Œ å› ä¸ºä½ éœ€è¦å°†æ•°æ®ä½œä¸ºæŸ¥è¯¢æ”¾åˆ°URLä¸­ã€‚

æ­¤ç¨‹åºä¸ºä¸€ç§æ•°æ®æ ¼å¼æä¾›äº†æ›´å¥½çš„çš„æ¥å£ï¼š **ç»™å®šä¸€å°æ®µæ–‡æœ¬ï¼Œå®ƒå°†è°ƒç”¨å›¾è¡¨æœåŠ¡å™¨æ¥ç”ŸæˆäºŒç»´ç ï¼ˆQRç ï¼‰**ï¼Œè¿™æ˜¯ä¸€ç§ç¼–ç æ–‡æœ¬çš„ç‚¹æ ¼çŸ©é˜µã€‚ è¯¥å›¾åƒå¯è¢«ä½ çš„æ‰‹æœºæ‘„åƒå¤´æ•è·ï¼Œå¹¶è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚URLï¼Œ è¿™æ ·å°±å…å»äº†ä½ åœ¨ç‹­å°çš„æ‰‹æœºé”®ç›˜ä¸Šé”®å…¥URLçš„éº»çƒ¦ã€‚

ä»¥ä¸‹ä¸ºå®Œæ•´çš„ç¨‹åºï¼Œéšåæœ‰ä¸€æ®µè§£é‡Šã€‚

```go
package main

import (
    "flag"
    "html/template"
    "log"
    "net/http"
)

var addr = flag.String("addr", ":1718", "http service address") // Q=17, R=18

var templ = template.Must(template.New("qr").Parse(templateStr))

func main() {
    flag.Parse()
    http.Handle("/", http.HandlerFunc(QR))
    err := http.ListenAndServe(*addr, nil)
    if err != nil {
        log.Fatal("ListenAndServe:", err)
    }
}

func QR(w http.ResponseWriter, req *http.Request) {
    templ.Execute(w, req.FormValue("s"))
}

const templateStr = `
<html>
<head>
<title>QR Link Generator</title>
</head>
<body>
{{if .}}
<img src="http://chart.apis.google.com/chart?chs=300x300&cht=qr&choe=UTF-8&chl={{.}}" />
<br>
{{.}}
<br>
<br>
{{end}}
<form action="/" name=f method="GET"><input maxLength=1024 size=70
name=s value="" title="Text to QR Encode"><input type=submit
value="Show QR" name=qr>
</form>
</body>
</html>
`
```

`main` ä¹‹å‰çš„ä»£ç åº”è¯¥æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ ‡å¿—ä¸ºæœåŠ¡å™¨è®¾ç½®äº†é»˜è®¤ç«¯å£ã€‚ æ¨¡æ¿å˜é‡ `templ` æ­£å¼æœ‰è¶£çš„åœ°æ–¹ã€‚å®ƒæ„å»ºçš„HTMLæ¨¡ç‰ˆå°†ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œå¹¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ã€‚ ç¨åæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºã€‚

`main` å‡½æ•°è§£æäº†å‚æ•°æ ‡å¿—å¹¶ä½¿ç”¨æˆ‘ä»¬è®¨è®ºè¿‡çš„æœºåˆ¶å°† `QR` å‡½æ•°ç»‘å®šåˆ°æœåŠ¡å™¨çš„æ ¹è·¯å¾„ã€‚ç„¶åè°ƒç”¨ `http.ListenAndServe` å¯åŠ¨æœåŠ¡å™¨ï¼›å®ƒå°†åœ¨æœåŠ¡å™¨è¿è¡Œæ—¶å¤„äºé˜»å¡çŠ¶æ€ã€‚

`QR` ä»…æ¥å—åŒ…å«è¡¨å•æ•°æ®çš„è¯·æ±‚ï¼Œå¹¶ä¸ºè¡¨å•å€¼ `s` ä¸­çš„æ•°æ®æ‰§è¡Œæ¨¡æ¿ã€‚

æ¨¡æ¿åŒ… `html/template` éå¸¸å¼ºå¤§ï¼›è¯¥ç¨‹åºåªæ˜¯æµ…å°è¾„æ­¢ã€‚ æœ¬è´¨ä¸Šï¼Œå®ƒé€šè¿‡åœ¨è¿è¡Œæ—¶å°†æ•°æ®é¡¹ä¸­æå–çš„å…ƒç´ ï¼ˆåœ¨è¿™é‡Œæ˜¯è¡¨å•å€¼ï¼‰ä¼ ç»™ `templ.Execute` æ‰§è¡Œå› è€Œé‡å†™äº†HTMLæ–‡æœ¬ã€‚ åœ¨æ¨¡æ¿æ–‡æœ¬ï¼ˆ`templateStr`ï¼‰ä¸­ï¼ŒåŒå¤§æ‹¬å·ç•Œå®šçš„æ–‡æœ¬è¡¨ç¤ºæ¨¡æ¿çš„åŠ¨ä½œã€‚ ä» `{{if .}}` åˆ° `{{end}}` çš„ä»£ç æ®µä»…åœ¨å½“å‰æ•°æ®é¡¹ï¼ˆè¿™é‡Œæ˜¯ç‚¹ `.`ï¼‰çš„å€¼éç©ºæ—¶æ‰ä¼šæ‰§è¡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å­—ç¬¦ä¸²ä¸ºç©ºæ—¶ï¼Œæ­¤éƒ¨åˆ†æ¨¡æ¿æ®µä¼šè¢«å¿½ç•¥ã€‚

å…¶ä¸­ä¸¤æ®µ `{{.}}` è¡¨ç¤ºè¦å°†æ•°æ®æ˜¾ç¤ºåœ¨æ¨¡æ¿ä¸­ ï¼ˆå³å°†æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¾ç¤ºåœ¨Webé¡µé¢ä¸Šï¼‰ã€‚HTMLæ¨¡æ¿åŒ…å°†è‡ªåŠ¨å¯¹æ–‡æœ¬è¿›è¡Œè½¬ä¹‰ï¼Œ å› æ­¤æ–‡æœ¬çš„æ˜¾ç¤ºæ˜¯å®‰å…¨çš„ã€‚

ä½™ä¸‹çš„æ¨¡æ¿å­—ç¬¦ä¸²åªæ˜¯é¡µé¢åŠ è½½æ—¶å°†è¦æ˜¾ç¤ºçš„HTMLã€‚

## å†…å­˜ goroutine

> Goå†…å­˜æ¨¡å‹é˜æ˜äº†ä¸€ä¸ªGoç¨‹å¯¹æŸå˜é‡çš„å†™å…¥ï¼Œå¦‚ä½•æ‰èƒ½ç¡®ä¿è¢«å¦ä¸€ä¸ªè¯»å–è¯¥å˜é‡çš„Goç¨‹ç›‘æµ‹åˆ°ã€‚

:warning:** ç¨‹åºåœ¨ä¿®æ”¹è¢«å¤šä¸ªGoç¨‹åŒæ—¶è®¿é—®çš„æ•°æ®æ—¶å¿…é¡»åºåˆ—åŒ–è¯¥è®¿é—®ã€‚**

**è¦åºåˆ—åŒ–è®¿é—®ï¼Œéœ€é€šè¿‡ä¿¡é“æ“ä½œï¼Œæˆ–å…¶å®ƒåƒ [`sync`](https://go-zh.org/pkg/sync/) å’Œ [`sync/atomic`](https://go-zh.org/pkg/sync/atomic/) åŒ…ä¸­çš„åŒæ­¥åŸè¯­æ¥ä¿æŠ¤æ•°æ®ã€‚**

### äº‹ä»¶å‘ç”Ÿçš„æ¬¡åº

**åœ¨å•ä¸ªGoç¨‹ä¸­ï¼Œè¯»å–å’Œå†™å…¥çš„è¡¨ç°å¿…é¡»ä¸ç¨‹åºæŒ‡å®šçš„æ‰§è¡Œé¡ºåºç›¸ä¸€è‡´ã€‚**æ¢è¨€ä¹‹ï¼Œ ä»…åœ¨ä¸ä¼šæ”¹å˜è¯­è¨€è§„èŒƒå¯¹Goç¨‹è¡Œä¸ºçš„å®šä¹‰æ—¶ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ‰ä¼šå¯¹è¯»å–å’Œå†™å…¥çš„æ‰§è¡Œé‡æ–°æ’åºã€‚ ç”±äºå­˜åœ¨é‡æ–°æ’åºï¼Œä¸€ä¸ªGoç¨‹ç›‘æµ‹åˆ°çš„æ‰§è¡Œé¡ºåºå¯èƒ½ä¸å¦ä¸€ä¸ªGoç¨‹ç›‘åˆ°çš„ä¸åŒã€‚ä¾‹å¦‚ï¼Œè‹¥ä¸€ä¸ªGoç¨‹æ‰§è¡Œ `a = 1; b = 2;`ï¼Œå¦ä¸€ä¸ªGoç¨‹å¯èƒ½ç›‘æµ‹åˆ° `b` çš„å€¼å…ˆäº `a` æ›´æ–°ã€‚

ä¸ºäº†è¯¦ç»†è®ºè¿°è¯»å–å’Œå†™å…¥çš„å¿…è¦æ¡ä»¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†**äº‹ä»¶å‘ç”Ÿé¡ºåº**ï¼Œå®ƒè¡¨ç¤ºGoç¨‹åºä¸­å†…å­˜æ“ä½œæ‰§è¡Œçš„ [ååºå…³ç³»](http://zh.wikipedia.org/wiki/ååºå…³ç³»)ã€‚ è‹¥äº‹ä»¶ *e1* å‘ç”Ÿåœ¨ *e2* ä¹‹å‰ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å°±è¯´ *e2* å‘ç”Ÿåœ¨ *e1* ä¹‹åã€‚ æ¢è¨€ä¹‹ï¼Œè‹¥ *e1* æ—¢æœªå‘ç”Ÿåœ¨ *e2* ä¹‹å‰ï¼Œ åˆæœªå‘ç”Ÿåœ¨ *e2* ä¹‹åï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´ *e1* ä¸ *e2* æ˜¯å¹¶å‘çš„ã€‚

åœ¨å•ä¸€Goç¨‹ä¸­ï¼Œäº‹ä»¶å‘ç”Ÿçš„é¡ºåºå³ä¸ºç¨‹åºæ‰€è¡¨è¾¾çš„é¡ºåºã€‚

è‹¥ä»¥ä¸‹æ¡ä»¶å‡æˆç«‹ï¼Œåˆ™å¯¹å˜é‡ `v` çš„è¯»å–æ“ä½œ *r* å°±**å…è®¸**å¯¹ `v` çš„å†™å…¥æ“ä½œ *w* è¿›è¡Œç›‘æµ‹ï¼š

1. *r* ä¸å‘ç”Ÿåœ¨ *w* ä¹‹å‰ã€‚
2. åœ¨ *w* ä¹‹å *r* ä¹‹å‰ï¼Œä¸å­˜åœ¨å…¶å®ƒå¯¹ `v` è¿›è¡Œçš„å†™å…¥æ“ä½œ *w'*ã€‚

ä¸ºç¡®ä¿å¯¹å˜é‡ `v` çš„è¯»å–æ“ä½œ *r* èƒ½å¤Ÿç›‘æµ‹åˆ°ç‰¹å®šçš„å¯¹ `v` è¿›è¡Œå†™å…¥çš„æ“ä½œ *w*ï¼Œéœ€ç¡®ä¿ *w* æ˜¯å”¯ä¸€å…è®¸è¢« *r* ç›‘æµ‹çš„å†™å…¥æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ä»¥ä¸‹æ¡ä»¶å‡æˆç«‹ï¼Œåˆ™ *r* èƒ½**ä¿è¯**ç›‘æµ‹åˆ° *w*ï¼š

1. *w* å‘ç”Ÿåœ¨ *r* ä¹‹å‰ã€‚
2. å¯¹å…±äº«å˜é‡ `v` çš„å…¶å®ƒä»»ä½•å†™å…¥æ“ä½œéƒ½åªèƒ½å‘ç”Ÿåœ¨ *w* ä¹‹å‰æˆ– *r* ä¹‹åã€‚

è¿™å¯¹æ¡ä»¶çš„è¦æ±‚æ¯”ç¬¬ä¸€å¯¹æ›´å¼ºï¼Œå®ƒéœ€è¦ç¡®ä¿æ²¡æœ‰å…¶å®ƒå†™å…¥æ“ä½œä¸ *w* æˆ– *r* å¹¶å‘ã€‚

åœ¨å•ä¸ªGoç¨‹ä¸­å¹¶ä¸å­˜åœ¨å¹¶å‘ï¼Œå› æ­¤è¿™ä¸¤æ¡å®šä¹‰æ˜¯ç­‰ä»·çš„ï¼šè¯»å–æ“ä½œ *r* å¯ç›‘æµ‹æœ€è¿‘çš„å†™å…¥æ“ä½œ *w* å¯¹ `v` å†™å…¥çš„å€¼ã€‚å½“å¤šä¸ªGoç¨‹è®¿é—®å…±äº«å˜é‡ `v` æ—¶ï¼Œå®ƒä»¬å¿…é¡»é€šè¿‡åŒæ­¥äº‹ä»¶æ¥å»ºç«‹å‘ç”Ÿé¡ºåºçš„æ¡ä»¶ï¼Œä»¥æ­¤ç¡®ä¿è¯»å–æ“ä½œèƒ½ç›‘æµ‹åˆ°é¢„æœŸçš„å†™å…¥ã€‚

ä»¥å˜é‡ `v` æ‰€å±ç±»å‹çš„é›¶å€¼æ¥å¯¹ `v` è¿›è¡Œåˆå§‹åŒ–ï¼Œå…¶è¡¨ç°å¦‚åŒåœ¨å†…å­˜æ¨¡å‹ä¸­è¿›è¡Œçš„å†™å…¥æ“ä½œã€‚

å¯¹å¤§äºå•ä¸ªæœºå™¨å­—çš„å€¼è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œå…¶è¡¨ç°å¦‚åŒä»¥ä¸ç¡®å®šçš„é¡ºåºå¯¹å¤šä¸ªæœºå™¨å­—å¤§å°çš„å€¼è¿›è¡Œæ“ä½œã€‚

> è¯‘æ³¨(Ants Arks)ï¼š
**a ä¸åœ¨ b ä¹‹å‰ï¼Œå¹¶ä¸æ„å‘³ç€ a å°±åœ¨ b ä¹‹åï¼Œå®ƒä»¬å¯ä»¥å¹¶å‘ã€‚è¿™æ ·çš„è¯ï¼Œç¬¬ä¸€ç§è¯´æ³•ï¼Œ å³å¯¹äºä¸¤ä¸ªå¹¶å‘çš„Goç¨‹æ¥è¯´ï¼Œä¸€ä¸ªGoç¨‹èƒ½å¦è¯»åˆ°å¦ä¸€ä¸ªGoç¨‹å†™å…¥çš„æ•°æ®ï¼Œå¯èƒ½æœ‰ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚ ç¬¬äºŒç§è¯´æ³•ï¼Œç”±äº r å‘ç”Ÿåœ¨ w ä¹‹åï¼Œr ä¹‹å‰å¹¶æ²¡æœ‰å…¶å®ƒçš„ w'ï¼Œä¹Ÿæ²¡æœ‰ w" å’Œ r å¹¶åˆ—ï¼Œå› æ­¤ r è¯»åˆ°çš„å€¼å¿…ç„¶æ˜¯ w å†™å…¥çš„å€¼ã€‚ä¸‹é¢ç»“åˆå›¾å½¢è¿›è¡Œè¯´æ˜ï¼Œå…¶ä¸­ r ä¸º readï¼Œw ä¸º writeï¼Œå®ƒä»¬éƒ½å¯¹å€¼è¿›è¡Œæ“ä½œ.**

```txt
å•Goç¨‹çš„æƒ…å½¢ï¼š
-- w0 ---- r1 -- w1 ---- w2 ----  r2 ---- r3 ------>

è¿™é‡Œä¸ä»…æ˜¯ä¸ªååºå…³ç³»ï¼Œè¿˜æ˜¯ä¸€ä¸ªè‰¯åºå…³ç³»ï¼šæ‰€æœ‰ r/w çš„å…ˆåé¡ºåºéƒ½æ˜¯å¯æ¯”è¾ƒçš„ã€‚

åŒGoç¨‹çš„æƒ…å½¢ï¼š
-- w0 -- r1 -- r2 ---- w3 ----  w4 ---- r5 -------->
-- w1 ----- w2 -- r3 ----  r4 ---- w5 -------->

å•Goç¨‹ä¸Šçš„äº‹ä»¶éƒ½æœ‰å…ˆåé¡ºåºï¼›è€Œå¯¹äºä¸¤æ¡Goç¨‹ï¼Œæƒ…å†µåˆæœ‰æ‰€ä¸åŒã€‚å³ä¾¿åœ¨æ—¶é—´ä¸Š r1 å…ˆäº w2 å‘ç”Ÿï¼Œ
ä½†ç”±äºæ¯æ¡Goç¨‹çš„æ‰§è¡Œæ—¶é•¿éƒ½åƒçš®ç­‹ä¸€æ ·ä¼¸ç¼©ä¸å®šï¼Œå› æ­¤äºŒè€…åœ¨é€»è¾‘ä¸Šå¹¶æ— å…ˆåæ¬¡åºã€‚æ¢è¨€ä¹‹ï¼Œå³äºŒè€…å¹¶å‘ã€‚
å¯¹äºå¹¶å‘çš„ r/wï¼Œr3 è¯»å–çš„ç»“æœå¯èƒ½æ˜¯å‰é¢çš„ w2ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸Šé¢çš„ w3ï¼Œç”šè‡³ w4 çš„å€¼ï¼›
è€Œ r5 è¯»å–çš„ç»“æœï¼Œå¯èƒ½æ˜¯ w4 çš„å€¼ï¼Œä¹Ÿèƒ½æ˜¯ w1ã€w2ã€w5 çš„å€¼ï¼Œä½†ä¸å¯èƒ½æ˜¯ w3 çš„å€¼ã€‚


åŒGoç¨‹äº¤å‰åŒæ­¥çš„æƒ…å½¢ï¼š
-- r0 -- r1 ---|------ r2 ------------|-- w5 ------>
-- w1 --- w2 --|-- r3 ---- r4 -- w4 --|------->

ç°åœ¨ä¸Šé¢æ·»åŠ äº†ä¸¤ä¸ªåŒæ­¥ç‚¹ï¼Œå³ | å¤„ã€‚è¿™æ ·çš„è¯ï¼Œr3 å°±æ˜¯åäº r1 ï¼Œå…ˆäº w5 å‘ç”Ÿçš„ã€‚
r2 ä¹‹å‰çš„å†™å…¥ä¸º w2ï¼Œä½†ä¸å…¶å¹¶å‘çš„æœ‰ w4ï¼Œå› æ­¤ r2 çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼šå¯ä»¥æ˜¯ w2ï¼Œä¹Ÿå¯ä»¥æ˜¯ w4ã€‚
è€Œ r4 ä¹‹å‰çš„å†™å…¥çš„æ˜¯ w2ï¼Œä¸å®ƒå¹¶å‘çš„å¹¶æ²¡æœ‰å†™å…¥ï¼Œå› æ­¤ r4 è¯»å–çš„å€¼ä¸º w2ã€‚
```

åˆ°è¿™é‡Œï¼ŒGoç¨‹é—´çš„å…³ç³»å°±å¾ˆæ¸…æ¥šäº†ã€‚è‹¥ä¸åŠ åŒæ­¥æ§åˆ¶ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„Goç¨‹éƒ½æ˜¯â€œå¹³è¡Œâ€å¹¶å‘çš„ã€‚æ¢å¥è¯è¯´ï¼Œ **è‹¥ä¸è¿›è¡ŒåŒæ­¥ï¼Œé‚£ä¹ˆ main å‡½æ•°ä»¥å¤–çš„Goç¨‹éƒ½æ˜¯æ— æ„ä¹‰çš„ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥è®¤ä¸º main è·Ÿå®ƒä»¬æ²¡æœ‰å…³ç³»ã€‚** åªæœ‰åŠ ä¸ŠåŒæ­¥æ§åˆ¶ï¼Œä¾‹å¦‚é”æˆ–ä¿¡é“ï¼ŒGoç¨‹é—´æ‰æœ‰äº†ç›¸åŒçš„â€œèŠ‚ç‚¹â€ï¼Œåœ¨å®ƒä»¬çš„ä¸¤è¾¹ä¹Ÿå°±æœ‰äº†æ‰§è¡Œçš„å…ˆåé¡ºåºï¼Œ ä¸è¿‡ä¸¤ä¸ªâ€œèŠ‚ç‚¹â€ä¹‹é—´çš„éƒ¨åˆ†ï¼ŒåŒæ ·è¿˜æ˜¯å¯ä»¥è‡ªç”±ä¼¸ç¼©ï¼Œæ²¡æœ‰å…ˆåé¡ºåºçš„ã€‚å¦‚æ­¤æ¨å¹¿ï¼Œå¤šæ¡Goç¨‹çš„åŒæ­¥å°±æˆäº†æœ‰å‘çš„ç½‘ã€‚

### åŒæ­¥ sync

#### åˆå§‹åŒ– 

ç¨‹åºçš„åˆå§‹åŒ–è¿è¡Œåœ¨å•ä¸ªGoç¨‹ä¸­ï¼Œä½†è¯¥Goç¨‹å¯èƒ½ä¼šåˆ›å»ºå…¶å®ƒå¹¶å‘è¿è¡Œçš„Goç¨‹ã€‚

è‹¥åŒ… `p` å¯¼å…¥äº†åŒ… `q`ï¼Œåˆ™ `q` çš„ `init` å‡½æ•°ä¼šåœ¨ `p` çš„ä»»ä½•å‡½æ•°å¯åŠ¨å‰å®Œæˆã€‚

å‡½æ•° `main.main` ä¼šåœ¨æ‰€æœ‰çš„ `init` å‡½æ•°ç»“æŸåå¯åŠ¨ã€‚



#### goç¨‹çš„é”€æ¯

Goç¨‹æ— æ³•ç¡®ä¿åœ¨ç¨‹åºä¸­çš„ä»»ä½•äº‹ä»¶å‘ç”Ÿä¹‹å‰é€€å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨æ­¤ç¨‹åºä¸­ï¼š

```go
var a string

func hello() {
	go func() { a = "hello" }()
	print(a)
}
```

å¯¹ `a` è¿›è¡Œèµ‹å€¼åå¹¶æ²¡æœ‰ä»»ä½•åŒæ­¥äº‹ä»¶ï¼Œå› æ­¤å®ƒæ— æ³•ä¿è¯è¢«å…¶å®ƒä»»ä½•Goç¨‹æ£€æµ‹åˆ°ã€‚ å®é™…ä¸Šï¼Œä¸€ä¸ªç§¯æçš„ç¼–è¯‘å™¨å¯èƒ½ä¼šåˆ é™¤æ•´æ¡ `go` è¯­å¥ã€‚

**è‹¥ä¸€ä¸ªGoç¨‹çš„ä½œç”¨å¿…é¡»è¢«å¦ä¸€ä¸ªGoç¨‹ç›‘æµ‹åˆ°ï¼Œéœ€ä½¿ç”¨é”æˆ–ä¿¡é“é€šä¿¡ä¹‹ç±»çš„åŒæ­¥æœºåˆ¶æ¥å»ºç«‹é¡ºåºå…³ç³»ã€‚**



#### ä¿¡é“é€šä¿¡ 

* **ä¿¡é“ä¸Šçš„å‘é€æ“ä½œæ€»åœ¨å¯¹åº”çš„æ¥æ”¶æ“ä½œå®Œæˆå‰å‘ç”Ÿã€‚**

```go
var c = make(chan int, 10)
var a string

func f() {
	a = "hello, world"
	c <- 0
}

func main() {
	go f()
	<-c
	print(a)
}
>>>
//	hello, world
```

è¯¥ç¨‹åºé¦–å…ˆå¯¹ `a` è¿›è¡Œå†™å…¥ï¼Œ ç„¶ååœ¨ `c` ä¸Šå‘é€ä¿¡å·ï¼Œéšåä» `c` æ¥æ”¶å¯¹åº”çš„ä¿¡å·ï¼Œæœ€åæ‰§è¡Œ `print` å‡½æ•°ã€‚**è‹¥åœ¨ä¿¡é“å…³é—­åä»ä¸­æ¥æ”¶æ•°æ®ï¼Œæ¥æ”¶è€…å°±ä¼šæ”¶åˆ°è¯¥ä¿¡é“è¿”å›çš„é›¶å€¼ã€‚**

* **ä»æ— ç¼“å†²ä¿¡é“è¿›è¡Œçš„æ¥æ”¶ï¼Œè¦å‘ç”Ÿåœ¨å¯¹è¯¥ä¿¡é“è¿›è¡Œçš„å‘é€å®Œæˆä¹‹å‰ã€‚**

æ­¤ç¨‹åºï¼ˆ<u>*ä¸ä¸Šé¢çš„ç›¸åŒï¼Œä½†äº¤æ¢äº†å‘é€å’Œæ¥æ”¶è¯­å¥çš„ä½ç½®ï¼Œä¸”ä½¿ç”¨æ— ç¼“å†²ä¿¡é“*</u>ï¼‰:

```go
var c = make(chan int)
var a string

func f() {
	a = "hello, world"
	<-c
}
func main() {
	go f()
	c <- 0
	print(a)
}
>>>
//	hello,world
```

è‹¥è¯¥ä¿¡é“ä¸ºå¸¦ç¼“å†²çš„ï¼ˆä¾‹å¦‚ï¼Œ`c = make(chan int, 1)`ï¼‰ï¼Œ åˆ™è¯¥ç¨‹åºå°†æ— æ³•ä¿è¯æ‰“å°å‡º `"hello, world"`ã€‚ï¼ˆå®ƒå¯èƒ½ä¼šæ‰“å°å‡ºç©ºå­—ç¬¦ä¸²ï¼Œ å´©æºƒï¼Œæˆ–åšäº›åˆ«çš„äº‹æƒ…ã€‚ï¼‰



#### é” :lock:

* **å¯¹äºä»»ä½•** `sync.Mutex` **æˆ–** `sync.RWMutex` **ç±»å‹çš„å˜é‡** `l` **ä»¥åŠ** *n* **<** *m* **ï¼Œå¯¹** `l.Unlock()` **çš„ç¬¬** *n* **æ¬¡è°ƒç”¨åœ¨å¯¹** `l.Lock()` **çš„ç¬¬** *m* **æ¬¡è°ƒç”¨è¿”å›å‰å‘ç”Ÿã€‚**
* **å¯¹äºä»»ä½•** `sync.RWMutex` **ç±»å‹çš„å˜é‡** `l` **å¯¹** `l.RLock` **çš„è°ƒç”¨ï¼Œå­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„** *n***ï¼Œä½¿å¾—** `l.RLock` **åœ¨å¯¹** `l.Unlock` **çš„ç¬¬** *n* **æ¬¡è°ƒç”¨ä¹‹åå‘ç”Ÿï¼ˆè¿”å›ï¼‰ï¼Œä¸”ä¸å…¶ç›¸åŒ¹é…çš„** `l.RUnlock` **åœ¨å¯¹** `l.Lock`**çš„ç¬¬** *n+1* **æ¬¡è°ƒç”¨ä¹‹å‰å‘ç”Ÿã€‚**



#### Onceç±»å‹ :one:

`sync` åŒ…é€šè¿‡ `Once` ç±»å‹ä¸ºå­˜åœ¨å¤šä¸ªGoç¨‹çš„åˆå§‹åŒ–æä¾›äº†å®‰å…¨çš„æœºåˆ¶ã€‚ å¤šä¸ªçº¿ç¨‹å¯ä¸ºç‰¹å®šçš„ `f` æ‰§è¡Œ `once.Do(f)`ï¼Œ**ä½†åªæœ‰ä¸€ä¸ªä¼šè¿è¡Œ `f()`ï¼Œè€Œå…¶å®ƒè°ƒç”¨ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° `f()` è¿”å›ã€‚**

é€šè¿‡ `once.Do(f)` å¯¹ `f()` çš„å•æ¬¡è°ƒç”¨åœ¨å¯¹ä»»ä½•å…¶å®ƒçš„ `once.Do(f)` è°ƒç”¨è¿”å›ä¹‹å‰å‘ç”Ÿï¼ˆè¿”å›ï¼‰ã€‚

åœ¨æ­¤ç¨‹åºä¸­ï¼š

```go
var a string
var once sync.Once

func setup() {
	a = "hello, world"
}

func doprint() {
	once.Do(setup)
	print(a)
}

//   ç¬¬ä¸€æ¬¡å¯¹ twoprint çš„è°ƒç”¨ä¼šè¿è¡Œä¸€æ¬¡ setup()
func twoprint() {
	go doprint()
	go doprint()
}
>>>
/*
hello,world
hello,world
*/
```



### é”™è¯¯çš„åŒæ­¥

è¯·æ³¨æ„ï¼Œè¯»å–æ“ä½œ *r* å¯èƒ½ç›‘æµ‹åˆ°ä¸å…¶å¹¶å‘çš„å†™å…¥æ“ä½œ *w* å†™å…¥çš„å€¼ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿå¹¶ä¸æ„å‘³ç€å‘ç”Ÿåœ¨ *r* ä¹‹åçš„è¯»å–æ“ä½œä¼šç›‘æµ‹åˆ°å‘ç”Ÿåœ¨ *w* ä¹‹å‰çš„å†™å…¥æ“ä½œã€‚

åœ¨æ­¤ç¨‹åºä¸­ï¼š

```go
var a, b int

func f() {
	a = 1
	b = 2
}

func g() {
	print(b)
	print(a)
}

func main() {
	go f()
	g()
}
>>>>
// 	å¯èƒ½ä¼šå‘ç”Ÿ `g` æ‰“å°å‡º `2` ä¹‹åå†æ‰“å°å‡º `0`ã€‚
```

åŒé‡æ£€æµ‹é”æ˜¯ç§é¿å…åŒæ­¥å¼€é”€çš„å°è¯•ã€‚ä¾‹å¦‚ï¼Œ`twoprint` ç¨‹åºå¯èƒ½ä¼šé”™è¯¯åœ°å†™æˆï¼š

```go
var a string
var done bool

func setup() {
	a = "hello, world"
	done = true
}

func doprint() {
	if !done {
		once.Do(setup)
	}
	print(a)
}

func twoprint() {
	go doprint()
	go doprint()
}
>>>
/*	
ä½†è¿™é‡Œå¹¶ä¸ä¿è¯åœ¨ `doprint` ä¸­å¯¹ `done` çš„å†™å…¥è¿›è¡Œç›‘æµ‹è•´å«å¯¹ `a` çš„å†™å…¥è¿›è¡Œç›‘æµ‹ã€‚è¿™ä¸ªç‰ˆæœ¬å¯èƒ½ä¼šï¼ˆé”™è¯¯åœ°ï¼‰æ‰“å°å‡ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²è€Œé `"hello, world"`ã€‚	
*/
```

å¦ä¸€ç§é”™è¯¯çš„ä¹ æƒ¯å°±æ˜¯å¿™äºç­‰å¾…ä¸€ä¸ªå€¼ï¼Œå°±åƒè¿™æ ·ï¼š

```go
var a string
var done bool

func setup() {
	a = "hello, world"
	done = true
}

func main() {
	go setup()
	for !done {
	}
	print(a)
}
>>>
/*
å’Œå‰é¢ä¸€æ ·ï¼Œè¿™é‡Œä¸ä¿è¯åœ¨ `main` ä¸­å¯¹ `done` çš„å†™å…¥çš„ç›‘æµ‹ï¼Œ è•´å«å¯¹ `a` çš„å†™å…¥ä¹Ÿè¿›è¡Œç›‘æµ‹ï¼Œ
å› æ­¤è¯¥ç¨‹åºä¹Ÿå¯èƒ½ä¼šæ‰“å°å‡ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚ æ›´ç³Ÿçš„æ˜¯ï¼Œç”±äºåœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ²¡æœ‰åŒæ­¥äº‹ä»¶ï¼Œ
å› æ­¤æ— æ³•ä¿è¯å¯¹ `done` çš„å†™å…¥æ€»èƒ½è¢« `main` ç›‘æµ‹åˆ°ã€‚
`main` ä¸­çš„å¾ªç¯ä¸ä¿è¯ä¸€å®šèƒ½ç»“æŸã€‚
*/
```

è¿™ä¸ªä¸»é¢˜æœ‰ç§å¾®å¦™çš„å˜ä½“ï¼Œä¾‹å¦‚æ­¤ç¨‹åºï¼š

```go
type T struct {
	msg string
}

var g *T

func setup() {
	t := new(T)
	t.msg = "hello, world"
	g = t
}

func main() {
	go setup()
	for g == nil {
	}
	print(g.msg)
}
>>>
//	å³ä¾¿ `main` èƒ½å¤Ÿç›‘æµ‹åˆ° `g != nil` å¹¶é€€å‡ºå¾ªç¯ï¼Œ å®ƒä¹Ÿæ— æ³•ä¿è¯èƒ½ç›‘æµ‹åˆ° `g.msg` çš„åˆå§‹åŒ–å€¼ã€‚
```

è¿™é‡Œæ‰€æœ‰ä¾‹å­çš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯ç›¸åŒçš„ï¼šä½¿ç”¨æ˜¾å¼çš„åŒæ­¥

## å…¶ä»– :package:

[GOè¯­è¨€ä¸­æ–‡æ–‡æ¡£](https://go-zh.org/doc/)

**2020 GOå¼€å‘è€…æˆé•¿è·¯çº¿å›¾å‚è€ƒï¼š**
![GOè¯­è¨€å­¦ä¹ è·¯çº¿å›¾](/assets/golang-developer-roadmap-zh-CN.png)