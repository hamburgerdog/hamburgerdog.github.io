---
import Nav from '../components/nav.astro';
import '@fontsource-variable/space-grotesk';
import { ClientRouter } from 'astro:transitions';

const { title, subtitle, tags, remark, additionalSchemas } = Astro.props;

const author = 'Josiah Hong';
const authorAlias =
  '文章作者和作者别名为：Josiah Hong，josiahhong，hamburgerdog，xiaojun.hong，josiah hong，koasan，kosiahgen，洪晓浚';
const description = [title, subtitle, tags, remark, authorAlias].filter(Boolean).join(',');
const keywords = [title, tags, author].filter(Boolean).join(',');
// 主域名配置：无论从哪个域名访问，都使用 josiah1.com 作为主索引域名
const primaryDomain = 'https://josiah1.com';
// 构建当前页面的完整 canonical URL，强制使用主域名（josiah1.com）
// 这样无论用户从 hamburgerdog.github.io 还是 josiah1.com 访问，canonical 都指向 josiah1.com
const canonical = new URL(Astro.url.pathname + Astro.url.search, primaryDomain).toString();
// 当前页面 URL（用于 Open Graph），也使用主域名
const url = canonical;
// Open Graph 图片的绝对 URL，使用主域名
const ogImage = new URL('/josiah.png', primaryDomain).toString();

// 构建网站级别的结构化数据（Organization 和 WebSite）
const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: "Josiah Hong's Blog",
  url: primaryDomain,
  description: '这里是 Josiah Hong 的博客空间，纪录生活与技术分享',
  author: {
    '@type': 'Person',
    name: author,
    url: `${primaryDomain}`,
  },
  publisher: {
    '@type': 'Organization',
    name: "Josiah Hong's Blog",
    url: primaryDomain,
  },
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${primaryDomain}/blog/?q={search_term_string}`,
    },
    'query-input': 'required name=search_term_string',
  },
};

// 构建当前页面的结构化数据
const pageSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  '@id': canonical,
  url: canonical,
  name: title,
  description: description,
  inLanguage: 'zh-CN',
  isPartOf: {
    '@type': 'WebSite',
    name: "Josiah Hong's Blog",
    url: primaryDomain,
  },
  author: {
    '@type': 'Person',
    name: author,
  },
};
---

<style is:global lang="scss">
  :root {
    --primary-color: #000;
    --sub-text-color: #666;
    --background-color: #fff;
    --nav-background-color: #ffffffa0;
    --header-color: oklch(0.21 0.034 264.665);
    --text-color: oklch(0.373 0.034 259.733);
    --max-width: 640px;
    --highlight: #163b660a;
    --code-color: oklch(0.585 0.233 277.117);
    --link-color: oklch(0.656 0.241 154.32);

    --font-space-grotesk: 'Space Grotesk Variable';
    --font-mono: monospace;
    --default-font-family: var(--font-space-grotesk);
  }

  :root.dark {
    --primary-color: #fff;
    --sub-text-color: #aaa;
    --header-color: oklch(0.967 0.003 264.542);
    --background-color: #000;
    --nav-background-color: #000000a0;
    --text-color: oklch(0.872 0.01 258.338);
    --highlight: #6666667f;
  }

  :root code {
    font-family: var(--font-mono);
  }

  html {
    max-width: var(--max-width);
    font-family: var(--default-font-family,), ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
      'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
    background: var(--background-color);
    color: var(--text-color);
    margin: auto;
    cursor: default;
    word-spacing: 3px;
    line-height: calc(1em + 8px);
    font-size: 16px;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong {
    color: var(--header-color);
  }

  p {
    margin-block: 0;
  }

  p,
  span,
  li {
    line-height: calc(1em + 12px);
  }

  body {
    margin: 0;
  }

  a {
    color: var(--link-color);
  }

  code {
    font-size: 14px;
    padding: 2px;
    border-radius: 2px;
    background-color: var(--highlight);
    color: var(--code-color);
    font-weight: bold;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    code {
      font-size: 1em;
    }
  }
</style>

<style>
  .nav {
    z-index: 1;
    position: fixed;
    width: 100%;
    left: 0;
    background-color: var(--nav-background-color);
    backdrop-filter: blur(10px);
  }

  .fill_item {
    height: 55px;
  }

  @media (max-width: 768px) {
    .fill_item {
      height: 78px;
    }
  }
</style>

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Language" content="zh-CN" />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={author} />
    <meta name="robots" content="index, follow" />
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:url" content={url} />
    <meta property="og:site_name" content="Josiah Hong`s Blog" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <link rel="icon" type="image/svg+xml" href="/xjosiah.ico" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="sitemap" type="application/xml" href={`${primaryDomain}/sitemap-index.xml`} />
    <link rel="alternate" hreflang="zh-CN" href={canonical} />
    <link rel="canonical" href={canonical} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Josiah Hong</title>
    {/* 结构化数据：网站和页面信息 */}
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(pageSchema)} />
    {/* 额外的结构化数据（如博客文章、面包屑等） */}
    {additionalSchemas && additionalSchemas.map((schema) => (
      <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    ))}
    <ClientRouter />
  </head>
  <body>
    <main>
      <div class="nav">
        <Nav />
      </div>
      <!-- 占位符，补充 fixed Nav 的 -->
      <div class="fill_item"></div>
      <slot />
    </main>
    <script>
      import '../script/themeSwitch.js';
    </script>
  </body>
</html>
